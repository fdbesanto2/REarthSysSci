<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Plots with raster and rasterVis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="raster_intro.html">raster and netCDF in R</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="RMaps.html">Maps in R</a>
    </li>
    <li>
      <a href="rasterVis01.html">Visualization:  raster and rasterVis</a>
    </li>
    <li class="dropdown-header">Visualization of high-dimensional data</li>
    <li class="dropdown-header">Multivariate analyses</li>
    <li class="dropdown-header">Clustering</li>
    <li class="dropdown-header">Other R packages</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="geog495_ex01.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="packages-and-data.html">Install packages and data</a>
    </li>
    <li>
      <a href="GitHub.html">Git and GitHub</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF</a>
    </li>
    <li>
      <a href="install_Panoply.html">Install Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="project.html">GitHub project repository and web page</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Plots with raster and rasterVis</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#examples-of-the-use-of-the-raster-package-to-read-and-analyze-raster-data-sets"><span class="toc-section-number">1</span> Examples of the use of the raster package to read and analyze raster data sets</a><ul>
<li><a href="#preliminaries"><span class="toc-section-number">1.1</span> Preliminaries</a></li>
<li><a href="#reading-a-netcdf-file-using-the-raster-package"><span class="toc-section-number">1.2</span> Reading a netCDF file using the raster package</a></li>
</ul></li>
<li><a href="#rastervis-style-small-multiple-maps"><span class="toc-section-number">2</span> rasterVis-style small-multiple maps</a></li>
<li><a href="#time-series-plots"><span class="toc-section-number">3</span> Time-Series plots</a><ul>
<li><a href="#time-series-plot-of-consecutive-values"><span class="toc-section-number">3.1</span> Time-series plot of consecutive values</a></li>
<li><a href="#multi-panel-plot-of-monthly-time-series-data"><span class="toc-section-number">3.2</span> Multi-panel plot of monthly time series data</a></li>
</ul></li>
<li><a href="#hovmoller-and-horizon-plots"><span class="toc-section-number">4</span> Hovmöller and horizon plots</a><ul>
<li><a href="#set-up"><span class="toc-section-number">4.1</span> Set up</a></li>
<li><a href="#horizon-plot"><span class="toc-section-number">4.2</span> Horizon plot</a></li>
<li><a href="#hovmoller-plots-a-second-example"><span class="toc-section-number">4.3</span> Hovmöller plots – a second example</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="examples-of-the-use-of-the-raster-package-to-read-and-analyze-raster-data-sets" class="section level1">
<h1><span class="header-section-number">1</span> Examples of the use of the raster package to read and analyze raster data sets</h1>
<div id="preliminaries" class="section level2">
<h2><span class="header-section-number">1.1</span> Preliminaries</h2>
<p>The following files will be used here, and are available on the SFTP server, in the folders /nc_files and /Rmaps:</p>
<ul>
<li><code>ne_110m_admin_0_countries.shp</code> — world coastline and country borders</li>
<li><code>ne_110m_coastline.shp</code>— world coastlines</li>
<li><code>treecov.nc</code> — global UMD tree-cover data</li>
<li><code>cru_ts4.02.1961.1990.tmp.ltm.nc</code> — CRU monthly temperature time series, long-term means</li>
<li><code>cru_ts4.02.1901.2017.tmp.anm.nc</code>— CRU monthly temperature time series (1901-2017)</li>
<li><code>NOAA_ERSSTv5_sst.mnmean.nc</code> — NOAA SST monthly time series (1854 - 2019)</li>
<li><code>NOAA_ERSSTv5_sst.mon.ltm.1981-2010.nc</code>— NOAA SST time series, long-term means</li>
<li><code>HadCRUT.4.6.0.0.median.nc</code> — HadCRUtv4 — Hadley Centre/CRU merged temperature anomalies, 1850-2019</li>
</ul>
<p>Download or copy the files to a “data folder” like <code>&quot;/Users/bartlein/Projects/ESSD/data/nc_files&quot;</code>.</p>
<p>The following examples use functions from the <code>raster</code> and <code>rasterVis</code> packages to read and display a few data sets. The datasets used here happen to be stored as <code>netCDF</code> files, but the <code>raster</code> package can also read and write other formats that raster data are commonly stored in. The <code>raster</code> package implements three basic objects or classes: 1) a <code>rasterLayer</code>, which is a single 2-D, x-y array of values (e.g. a DEM), 2) a <code>rasterStack</code>, a set of individual co-registered (i.e. on the same grid) rasterLayer objects (usually different variables), and 3) a <code>rasterBrick</code>, representing a set of layers that make up 3-D data set of a particular variable, such as a climate variable observed over time, or a set of bands in a multi- or hyperspectral image. Individual layers can be assembled into a stack, and can also be formed by extracting a 2-D slice from a raster brick.</p>
<p>Load the appropriate packages (installing them first if they’re not present, i.e. <code>install.packages(&quot;maptools&quot;)</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(ncdf4)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(ncdf.tools)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(rasterVis)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">library</span>(zoo)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">library</span>(sf)</a></code></pre></div>
<p>For subsequent use, read the world country-outlines shape file:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">shp_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/shp_files/ne_110m_admin_0_countries/&quot;</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">shp_name &lt;-<span class="st"> &quot;ne_110m_admin_0_countries.shp&quot;</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">shp_file &lt;-<span class="st"> </span><span class="kw">paste</span>(shp_path, shp_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co"># read the shapefile</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">world_shp &lt;-<span class="st"> </span><span class="kw">read_sf</span>(shp_file)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">world_outline &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">st_geometry</span>(world_shp), <span class="dt">Class=</span><span class="st">&quot;Spatial&quot;</span>)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># plot the outline</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">plot</span>(world_outline, <span class="dt">col=</span><span class="st">&quot;gray80&quot;</span>, <span class="dt">lwd=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/readWorldFake-1.png" width="75%" height="75%" /></p>
</div>
<div id="reading-a-netcdf-file-using-the-raster-package" class="section level2">
<h2><span class="header-section-number">1.2</span> Reading a netCDF file using the raster package</h2>
<p>Read a single-variable netCDF dataset describing global tree cover using the <code>raster()</code> function, which operates on a filename. Individual characteristics of the data can be displayed using some utility functions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># read a single-variable netCDF dataset using raster()</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">tree_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/nc_files/&quot;</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">tree_name &lt;-<span class="st"> &quot;treecov.nc&quot;</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">tree_file &lt;-<span class="st"> </span><span class="kw">paste</span>(tree_path, tree_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">tree &lt;-<span class="st"> </span><span class="kw">raster</span>(tree_file) <span class="co"># open treecov.nc</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">print</span>(tree) <span class="co"># netCDF info</span></a></code></pre></div>
<pre><code>## File /Users/bartlein/Projects/ESSD/data/nc_files/treecov.nc (NC_FORMAT_CLASSIC):
## 
##      1 variables (excluding dimension variables):
##         float treecov[lon,lat]   
##             name: treecov
##             long_name: treecov
##             units: 1
##             _FillValue: -9
## 
##      2 dimensions:
##         lon  Size:720
##             standard_name: longitude
##             long_name: longitude
##             units: degrees_east
##             axis: X
##         lat  Size:360
##             standard_name: latitude
##             long_name: latitude
##             units: degrees_north
##             axis: Y
## 
##     3 global attributes:
##         source: UMD Tree Cover Data resampled to 0.5-degrees
##         data: gl-latlong-8km-landcover.bsq.gz
##         history: P.J. Bartlein, 20 Feb 2008</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">tree <span class="co"># raster info</span></a></code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 360, 720, 259200  (nrow, ncol, ncell)
## resolution  : 0.5, 0.5  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/bartlein/Projects/ESSD/data/nc_files/treecov.nc 
## names       : treecov 
## zvar        : treecov</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">c</span>(<span class="kw">filename</span>(tree), <span class="kw">hasValues</span>(tree), <span class="kw">inMemory</span>(tree)))</a></code></pre></div>
<pre><code>## [1] &quot;/Users/bartlein/Projects/ESSD/data/nc_files/treecov.nc&quot;
## [2] &quot;TRUE&quot;                                                  
## [3] &quot;FALSE&quot;</code></pre>
<p>In the above example, the <code>raster()</code> function opens the netCDF file, and creates a raster object (<code>tree</code>). Printing this object using the <code>print()</code> function displays the netCDF metadata (or “attributes”), while simply “typing” the object name displays the attributes of the <code>raster</code> object. The functions <code>filename()</code>, <code>hasValues()</code> and <code>inMemory()</code> display the filename of the object, whether it currently contains values, and whether it is stored in memory, or still resides on disk. In this case, the data in the file <code>/Users/bartlein/Projects/ESSD/data/nc_files/treecov.nc</code> still resides on disk (<code>inMemory(tree) = FALSE</code>).</p>
<p>The range of <code>tree</code> (tree cover) can be gotten with the <code>cellStats()</code> function. Values less than 0.0 indicate barren land-surfac cover, and these values can be recoded to be equal to 0.0.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">c</span>(<span class="kw">cellStats</span>(tree,<span class="dt">stat=</span><span class="st">&#39;min&#39;</span>), <span class="kw">cellStats</span>(tree,<span class="dt">stat=</span><span class="st">&#39;max&#39;</span>)))</a></code></pre></div>
<pre><code>## [1] -2 80</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">tree[tree <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>Next, a basic plot of the data can be generated using the <code>levelplot()</code> function. (The <code>rasterVis</code> package implements a number of Lattice-type plots for raster data sets.)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># basic plot</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">levelplot</span>(tree)</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/rstr06-1.png" width="75%" height="75%" /></p>
<p>A better map can be genrated by setting a <code>rasterTheme</code> (in this case a progressive color scale of green from the <code>RColorBrewer</code> palette), generating the <code>levelplot()</code> object, and then adding a layer to the plot consisting of the countru outlines (<code>world.shp</code>).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># plot with outlines, a better color scale, no marginal plots</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">mapTheme &lt;-<span class="st"> </span><span class="kw">rasterTheme</span>(<span class="dt">region=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Greens&quot;</span>))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(tree, <span class="dt">margin=</span>F, <span class="dt">par.settings=</span>mapTheme)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">plt <span class="op">+</span><span class="st"> </span>latticeExtra<span class="op">::</span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(world_outline, <span class="dt">col=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>))</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/rstr07-1.png" width="75%" height="75%" /></p>
<p>Notice in the code above the specification of the <code>layer()</code> function as <code>latticeExtra::layer()</code>. This distinguishes betwee the layer function in the the <code>latticeExtra</code> package from that in <code>ggplot2</code>.</p>
<p>Here is another version, with outlines, a better color scale, and “marginal plots”.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># plot with outlines, a better color scale, marginal plots</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">mapTheme &lt;-<span class="st"> </span><span class="kw">rasterTheme</span>(<span class="dt">region=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Greens&quot;</span>))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(tree, <span class="dt">margin=</span>T, <span class="dt">par.settings=</span>mapTheme)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">plt <span class="op">+</span><span class="st"> </span>latticeExtra<span class="op">::</span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(world_outline, <span class="dt">col=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>))</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/rstr08-1.png" width="75%" height="75%" /></p>
<p><a href="rasterVis01.html">[Back to top]</a></p>
</div>
</div>
<div id="rastervis-style-small-multiple-maps" class="section level1">
<h1><span class="header-section-number">2</span> rasterVis-style small-multiple maps</h1>
<p>Small-multiple maps consist of an array of maps, each with the same cooridinate system, that can be used, for example, to plot long-term mean values for individual maps. Here, the long-term means of CRU TS 4.02 near-surface air temperature data will be plotted. First, read in another shapefile, with only coastlines.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># set path and shape file name</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">coast_shp_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/RMaps/source/ne_110m_coastline/&quot;</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">coast_shp_name &lt;-<span class="st"> &quot;ne_110m_coastline.shp&quot;</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">coast_shp_file &lt;-<span class="st"> </span><span class="kw">paste</span>(coast_shp_path, coast_shp_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co"># read the shapefile</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">coast_shp &lt;-<span class="st"> </span><span class="kw">read_sf</span>(coast_shp_file)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">coast_outline &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">st_geometry</span>(coast_shp), <span class="dt">Class=</span><span class="st">&quot;Spatial&quot;</span>)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co"># plot the outline</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="kw">plot</span>(coast_outline, <span class="dt">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="dt">lwd=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/readCoast-1.png" width="75%" height="75%" /></p>
<p>Set the path, file, and variable names for the CRU data:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># path and file name, set dname</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">ncpath &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/nc_files/&quot;</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">ncname &lt;-<span class="st"> &quot;cru_ts4.02.1961.1990.tmp.ltm.nc&quot;</span>   </a>
<a class="sourceLine" id="cb17-4" data-line-number="4">ncfname &lt;-<span class="st"> </span><span class="kw">paste</span>(ncpath, ncname, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">dname &lt;-<span class="st"> &quot;tmp_ltm&quot;</span>  <span class="co"># note: tmp means temperature (not temporary)</span></a></code></pre></div>
<p>Read the CRU data as a raster stack:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># read a raster stack</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">CRU_tmp_ltm &lt;-<span class="st"> </span><span class="kw">stack</span>(ncfname)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">CRU_tmp_ltm</a></code></pre></div>
<pre><code>## class       : RasterStack 
## dimensions  : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)
## resolution  : 0.5, 0.5  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## names       : X1976.01.16, X1976.02.15, X1976.03.16, X1976.04.16, X1976.05.16, X1976.06.16, X1976.07.16, X1976.08.16, X1976.09.16, X1976.10.16, X1976.11.16, X1976.12.16</code></pre>
<p>Replace the cryptic names in the raster stack with the names of months:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># replace layer names</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">names</span>(CRU_tmp_ltm) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>,<span class="st">&quot;Feb&quot;</span>,<span class="st">&quot;Mar&quot;</span>,<span class="st">&quot;Apr&quot;</span>,<span class="st">&quot;May&quot;</span>,<span class="st">&quot;Jun&quot;</span>,<span class="st">&quot;Jul&quot;</span>,<span class="st">&quot;Aug&quot;</span>,<span class="st">&quot;Sep&quot;</span>,<span class="st">&quot;Oct&quot;</span>,<span class="st">&quot;Nov&quot;</span>,<span class="st">&quot;Dec&quot;</span>)</a></code></pre></div>
<p>Create a <code>rasterVis</code> lattice-style levelplot. The plot will be rather large and time-consuming to plot, and so a more efficient way to produce it is to write it directly to a <code>.png</code> file. This is accomplished by braketing the necessary code for the levelplot with code to open a <code>.png</code> file:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># lattice-style levelplot</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">pngfile &lt;-<span class="st"> &quot;CRU_tmp_ltm.png&quot;</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw">png</span>(pngfile, <span class="dt">width=</span><span class="dv">729</span>, <span class="dt">height=</span><span class="dv">729</span>) <span class="co"># open the file</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4">cutpts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">50</span>,<span class="op">-</span><span class="dv">40</span>,<span class="op">-</span><span class="dv">30</span>,<span class="op">-</span><span class="dv">20</span>,<span class="op">-</span><span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(CRU_tmp_ltm , <span class="dt">at=</span>cutpts, <span class="dt">cuts=</span><span class="dv">11</span>, <span class="dt">pretty=</span>T, </a>
<a class="sourceLine" id="cb21-6" data-line-number="6">          <span class="dt">col.regions=</span>(<span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">10</span>,<span class="st">&quot;RdBu&quot;</span>))))</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">plt <span class="op">+</span><span class="st"> </span>latticeExtra<span class="op">::</span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(coast_outline, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#dev.off() # close the file</span></a></code></pre></div>
<p>Here’s what the image looks like:</p>
<p><img src="CRU_tmp_ltm.png" /></p>
</div>
<div id="time-series-plots" class="section level1">
<h1><span class="header-section-number">3</span> Time-Series plots</h1>
<p>A basic way of visualizing data in, for example, a 3-D netCDF file, with time being the third dimension, is to plot time series of individual grid points or areal averages. Here we’ll plot the CRU temperature data for the grid point closest to Eugene, both as a single time series with the monthly values in consecutive order, and in a multi-panel plot, with the data for each month of the year in a differnt panel. Begin by setting the path, file, and variable names:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># path and file name, set dname</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">ncpath &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/nc_files/&quot;</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">ncname &lt;-<span class="st"> &quot;cru_ts4.02.1901.2017.tmp.anm.nc&quot;</span>   </a>
<a class="sourceLine" id="cb22-4" data-line-number="4">ncfname &lt;-<span class="st"> </span><span class="kw">paste</span>(ncpath, ncname, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">dname &lt;-<span class="st"> &quot;tmp_anm&quot;</span>  <span class="co"># note: tmp means temperature (not temporary)</span></a></code></pre></div>
<p>Open the netCDF file</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># open a netCDF file</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">ncin &lt;-<span class="st"> </span><span class="kw">nc_open</span>(ncfname)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw">print</span>(ncin)</a></code></pre></div>
<pre><code>## File /Users/bartlein/Projects/ESSD/data/nc_files/cru_ts4.02.1901.2017.tmp.anm.nc (NC_FORMAT_NETCDF4):
## 
##      1 variables (excluding dimension variables):
##         float tmp_anm[lon,lat,time]   (Contiguous storage)  
##             units: degrees Celsius
##             _FillValue: 9.96920996838687e+36
##             long_name: near-surface air temperature anomalies
##             base_period: 1961 - 1990
## 
##      3 dimensions:
##         lon  Size:720
##             units: degrees_east
##             long_name: lon
##             axis: X
##         lat  Size:360
##             units: degrees_north
##             long_name: lat
##             axis: Y
##         time  Size:1404
##             units: days since 1900-1-1
##             long_name: time
##             axis: T
## 
##     6 global attributes:
##         title: CRU TS4.02 Mean Temperature
##         institution: Data held at British Atmospheric Data Centre, RAL, UK.
##         source: Run ID = 1811131722. Data generated from:tmp.1804231108.dtb
##         references: Information on the data is available at http://badc.nerc.ac.uk/data/cru/
##         history: P.J. Bartlein, Sun May 12 15:46:42 2019
##         Conventions: CF-1.4</code></pre>
<p>Get longitude, latitude and time:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># get longitude and latitude</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;lon&quot;</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">nlon &lt;-<span class="st"> </span><span class="kw">dim</span>(lon)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw">head</span>(lon)</a></code></pre></div>
<pre><code>## [1] -179.75 -179.25 -178.75 -178.25 -177.75 -177.25</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;lat&quot;</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">nlat &lt;-<span class="st"> </span><span class="kw">dim</span>(lat)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw">head</span>(lat)</a></code></pre></div>
<pre><code>## [1] -89.75 -89.25 -88.75 -88.25 -87.75 -87.25</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">c</span>(nlon,nlat))</a></code></pre></div>
<pre><code>## [1] 720 360</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># get time</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2">time &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co"># time # uncomment to see individual times</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">tunits &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,<span class="st">&quot;time&quot;</span>,<span class="st">&quot;units&quot;</span>)</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">nt &lt;-<span class="st"> </span><span class="kw">dim</span>(time)</a>
<a class="sourceLine" id="cb31-6" data-line-number="6">nt; tunits</a></code></pre></div>
<pre><code>## [1] 1404</code></pre>
<pre><code>## $hasatt
## [1] TRUE
## 
## $value
## [1] &quot;days since 1900-1-1&quot;</code></pre>
<p>Get the array of time series data:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="co"># get temperature</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">tmp_array &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,dname)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">dlname &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname,<span class="st">&quot;long_name&quot;</span>)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">dunits &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname,<span class="st">&quot;units&quot;</span>)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">fillvalue &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname,<span class="st">&quot;_FillValue&quot;</span>)</a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="kw">dim</span>(tmp_array)</a></code></pre></div>
<pre><code>## [1]  720  360 1404</code></pre>
<p>Convert the time variable from the <em>CF-Conventions</em> “time-since” format to a more conventional form:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># convert time -- split the time units string into fields</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="co"># convert time -- split the time units string into fields</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3">tustr &lt;-<span class="st"> </span><span class="kw">strsplit</span>(tunits<span class="op">$</span>value, <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">ptime &lt;-<span class="st"> </span><span class="kw">convertDateNcdf2R</span>(time, <span class="kw">unlist</span>(tustr)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="dt">origin =</span>  <span class="kw">as.POSIXct</span>(<span class="kw">unlist</span>(tustr)[<span class="dv">3</span>], <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>), <span class="dt">time.format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="kw">head</span>(time); <span class="kw">tail</span>(time)</a></code></pre></div>
<pre><code>## [1] 380 410 439 470 500 531</code></pre>
<pre><code>## [1] 42930 42961 42992 43022 43053 43083</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">head</span>(ptime); <span class="kw">tail</span>(ptime)</a></code></pre></div>
<pre><code>## [1] &quot;1901-01-16 UTC&quot; &quot;1901-02-15 UTC&quot; &quot;1901-03-16 UTC&quot; &quot;1901-04-16 UTC&quot; &quot;1901-05-16 UTC&quot; &quot;1901-06-16 UTC&quot;</code></pre>
<pre><code>## [1] &quot;2017-07-16 UTC&quot; &quot;2017-08-16 UTC&quot; &quot;2017-09-16 UTC&quot; &quot;2017-10-16 UTC&quot; &quot;2017-11-16 UTC&quot; &quot;2017-12-16 UTC&quot;</code></pre>
<p>Get the beginning and ending year of the time series:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># get beginning year and ending year, number of years, and set nm</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2">beg_date &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">as.character</span>(ptime[<span class="dv">1</span>]), <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">beg_yr &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">as.character</span>(beg_date), <span class="st">&quot;-&quot;</span>))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">beg_yr</a></code></pre></div>
<pre><code>## [1] 1901</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">end_date &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">as.character</span>(ptime[nt]), <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">end_yr &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">as.character</span>(end_date), <span class="st">&quot;-&quot;</span>))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">end_yr</a></code></pre></div>
<pre><code>## [1] 2017</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">nyrs &lt;-<span class="st"> </span>end_yr <span class="op">-</span><span class="st"> </span>beg_yr <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">nyrs</a></code></pre></div>
<pre><code>## [1] 117</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">nm &lt;-<span class="st"> </span><span class="dv">12</span></a></code></pre></div>
<p>Generate a decimal year value for plotting consecutive values:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="co"># generate a decimal year (&quot;YrMn&quot;) time coordinate</span></a>
<a class="sourceLine" id="cb49-2" data-line-number="2">YrMn &lt;-<span class="st"> </span><span class="kw">seq</span>(beg_yr, end_yr<span class="op">+</span><span class="dv">1</span><span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">12</span>), <span class="dt">by=</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">12</span>))</a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="kw">length</span>(YrMn)</a></code></pre></div>
<pre><code>## [1] 1404</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">head</span>(YrMn); <span class="kw">tail</span>(YrMn)</a></code></pre></div>
<pre><code>## [1] 1901.000 1901.083 1901.167 1901.250 1901.333 1901.417</code></pre>
<pre><code>## [1] 2017.500 2017.583 2017.667 2017.750 2017.833 2017.917</code></pre>
<p>Generate year and month values for creating the dataframe that will be used to get multi-panel plots:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="co"># year</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2">year &lt;-<span class="st"> </span><span class="kw">as.integer</span>(YrMn)</a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="kw">head</span>(year); <span class="kw">tail</span>(year)</a></code></pre></div>
<pre><code>## [1] 1901 1901 1901 1901 1901 1901</code></pre>
<pre><code>## [1] 2017 2017 2017 2017 2017 2017</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="co"># month</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="co"># month &lt;- rep(seq(1, 12, by=1), nyrs)</span></a>
<a class="sourceLine" id="cb57-3" data-line-number="3">month_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dec&quot;</span>,<span class="st">&quot;Jan&quot;</span>,<span class="st">&quot;Feb&quot;</span>,<span class="st">&quot;Mar&quot;</span>,<span class="st">&quot;Apr&quot;</span>,<span class="st">&quot;May&quot;</span>,<span class="st">&quot;Jun&quot;</span>,<span class="st">&quot;Jul&quot;</span>,<span class="st">&quot;Aug&quot;</span>,<span class="st">&quot;Sep&quot;</span>,<span class="st">&quot;Oct&quot;</span>,<span class="st">&quot;Nov&quot;</span>)</a>
<a class="sourceLine" id="cb57-4" data-line-number="4">month &lt;-<span class="st"> </span><span class="kw">rep</span>(month_names, nyrs)</a>
<a class="sourceLine" id="cb57-5" data-line-number="5"><span class="kw">head</span>(month); <span class="kw">tail</span>(month)</a></code></pre></div>
<pre><code>## [1] &quot;Dec&quot; &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot; &quot;Apr&quot; &quot;May&quot;</code></pre>
<pre><code>## [1] &quot;Jun&quot; &quot;Jul&quot; &quot;Aug&quot; &quot;Sep&quot; &quot;Oct&quot; &quot;Nov&quot;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">month &lt;-<span class="st"> </span><span class="kw">factor</span>(month, <span class="dt">levels=</span>month_names)</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="kw">class</span>(month)</a></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>Note that <code>month</code> is a factor, and without intervention, the monthly panels will plot in the default order for a factor: alphabetical. This would be a little counterintuitive to interpret, but the factor order can be reset using the code fragment <code>month &lt;- factor(month, levels=month_names)</code>, as was done above.</p>
<p>Now find the grid cell closest to Eugene (approximatly 123.1167 W and 44.08333 N). This is done by using the <code>which.min()</code> function:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="co"># get indices of the grid cell closest to Eugene</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2">tlon &lt;-<span class="st"> </span><span class="fl">-123.1167</span>; tlat &lt;-<span class="st"> </span><span class="fl">44.0833</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3">j &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(lon<span class="op">-</span>tlon))</a>
<a class="sourceLine" id="cb62-4" data-line-number="4">j; lon[j] </a></code></pre></div>
<pre><code>## [1] 114</code></pre>
<pre><code>## [1] -123.25</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">k &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(lat<span class="op">-</span>tlat))</a>
<a class="sourceLine" id="cb65-2" data-line-number="2">k; lat[k] </a></code></pre></div>
<pre><code>## [1] 269</code></pre>
<pre><code>## [1] 44.25</code></pre>
<div id="time-series-plot-of-consecutive-values" class="section level2">
<h2><span class="header-section-number">3.1</span> Time-series plot of consecutive values</h2>
<p>The data in the netCDF file are arranged in consecutive order, and so this is straightforward:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="co"># get time series for the closest gridpoint</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2">tmp_ts &lt;-<span class="st"> </span>tmp_array[j, k, ]</a>
<a class="sourceLine" id="cb68-3" data-line-number="3"></a>
<a class="sourceLine" id="cb68-4" data-line-number="4"><span class="co"># plot time series of grid point</span></a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="kw">plot</span>(YrMn, tmp_ts, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">ylab=</span>dname, <span class="dt">main=</span>dlname<span class="op">$</span>value, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/tsplot1-1.png" width="75%" height="75%" /></p>
</div>
<div id="multi-panel-plot-of-monthly-time-series-data" class="section level2">
<h2><span class="header-section-number">3.2</span> Multi-panel plot of monthly time series data</h2>
<p>Now make a dataframe consisting of <code>nt</code> values of the <code>YrMn</code> variable, the temperature time series <code>tmp_ts</code>, and the <code>year</code> and <code>month</code> variables generated above:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="co"># make dataframe</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2">tmp_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(YrMn, year, month, tmp_ts)</a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="kw">str</span>(tmp_df)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1404 obs. of  4 variables:
##  $ YrMn  : num  1901 1901 1901 1901 1901 ...
##  $ year  : int  1901 1901 1901 1901 1901 1901 1901 1901 1901 1901 ...
##  $ month : Factor w/ 12 levels &quot;Dec&quot;,&quot;Jan&quot;,&quot;Feb&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ tmp_ts: num  -0.713 -0.903 -0.637 -1.267 -0.293 ...</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="kw">head</span>(tmp_df); <span class="kw">tail</span>(tmp_df)</a></code></pre></div>
<pre><code>##       YrMn year month     tmp_ts
## 1 1901.000 1901   Dec -0.7133333
## 2 1901.083 1901   Jan -0.9033332
## 3 1901.167 1901   Feb -0.6366666
## 4 1901.250 1901   Mar -1.2666662
## 5 1901.333 1901   Apr -0.2933328
## 6 1901.417 1901   May -2.3033333</code></pre>
<pre><code>##          YrMn year month     tmp_ts
## 1399 2017.500 2017   Jun  1.6066670
## 1400 2017.583 2017   Jul  2.5000007
## 1401 2017.667 2017   Aug  1.6066672
## 1402 2017.750 2017   Sep -0.2266665
## 1403 2017.833 2017   Oct  0.7766663
## 1404 2017.917 2017   Nov -0.4133331</code></pre>
<p>Now, construct a <code>ggplot2</code> multi-panel (e.g. “faceted”) plot. The plot will be constructed with a lowess-smoother line in the background, overplotted by the annual values of each month in a separate panel.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> tmp_df, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>tmp_ts)) <span class="op">+</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="co"># geom_smooth(method = &quot;lm&quot;, size=2, color=&quot;pink&quot;) +</span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">color=</span><span class="st">&quot;purple&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb74-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_grid</span>(month <span class="op">~</span><span class="st"> </span>.)  </a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/tsggplot1-1.png" width="75%" height="75%" /></p>
<p>The plot seems quite wide relative to the vertical space occupied by each monthly time series, which makes it difficult to notice any trends in the daa. The aspect of the ratio can be adjusted, guided by the Bill Cleveland’s notion of “banking to 45 (degrees)”. The function <code>bank_slopes()</code> in the package <code>ggthemes</code> can find the aspect ratio that optimizes that notion for a single time series (here, the values for December):</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">bank_slopes</span>(tmp_df<span class="op">$</span>year[tmp_df<span class="op">$</span>month <span class="op">==</span><span class="st"> &quot;Dec&quot;</span>], tmp_df<span class="op">$</span>tmp_ts[tmp_df<span class="op">$</span>month <span class="op">==</span><span class="st"> &quot;Dec&quot;</span>])</a></code></pre></div>
<pre><code>## [1] 0.04174229</code></pre>
<p>A good first-guess aspect ratio can then be found by multiplying this value by the number of panels. However, experience shows that multiplying by the half the number of panels provides a more pleasing result:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> tmp_df, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>tmp_ts)) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="st">  </span><span class="co"># geom_smooth(method = &quot;lm&quot;, size=2, color=&quot;pink&quot;) +</span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">color=</span><span class="st">&quot;purple&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_grid</span>(month <span class="op">~</span><span class="st"> </span>.)  <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">aspect.ratio =</span> (<span class="fl">0.04</span> <span class="op">*</span><span class="st"> </span>(nm<span class="op">/</span><span class="dv">2</span>)))</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/tsggplot2-1.png" width="75%" height="75%" /></p>
<p><a href="rasterVis01.html">[Back to top]</a></p>
</div>
</div>
<div id="hovmoller-and-horizon-plots" class="section level1">
<h1><span class="header-section-number">4</span> Hovmöller and horizon plots</h1>
<p>The <code>rasterVis</code> package provides a couple of interesting <code>Lattice</code>-type plots that can be used to visualize 3-D data (usually a function of latitude, longitude and time). The Hovmöller plot is a 2-D time/space diagram, where, for example, zonal (E-W) or meridional (N-S) averages are plotted relative to time. The horizon plot plots multiple time series (here average values for individual latitudinal zones) in a way that allows common trends to be visualized.</p>
<p>The data set used here is the NOAA Extended Sea-Surface Temperature (SST) data. There is considerable set up to do first, which illustrates some of the necessary data wrangling the goes on before a visualization can be constructed. First the “observed” monthly values are read, then the long-term means, and then anomalies are calculated. The data are read using the <code>ncdf4</code> packages, which allows more flexibility in reading the data than does the <code>raster</code> package, and the resulting array is converted to a raster brick before plotting.</p>
<div id="set-up" class="section level2">
<h2><span class="header-section-number">4.1</span> Set up</h2>
<p>Read the SST data:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co"># read SST data</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2">SST_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/nc_files/&quot;</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3">SST_mon_name &lt;-<span class="st"> &quot;NOAA_ERSSTv5_sst.mnmean.nc&quot;</span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4">SST_mon_file &lt;-<span class="st"> </span><span class="kw">paste</span>(SST_path, SST_mon_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb78-5" data-line-number="5">dname_mon &lt;-<span class="st"> &quot;sst&quot;</span></a>
<a class="sourceLine" id="cb78-6" data-line-number="6">ncin &lt;-<span class="st"> </span><span class="kw">nc_open</span>(SST_mon_file)</a>
<a class="sourceLine" id="cb78-7" data-line-number="7"><span class="co"># print(ncin) # uncomment to see full ncdump-style listing</span></a></code></pre></div>
<p>Get longitude, latitudes and time:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="co"># get longitude and latitude</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2">lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;lon&quot;</span>)</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">nlon &lt;-<span class="st"> </span><span class="kw">dim</span>(lon)</a>
<a class="sourceLine" id="cb79-4" data-line-number="4"><span class="kw">head</span>(lon)</a></code></pre></div>
<pre><code>## [1]  0  2  4  6  8 10</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;lat&quot;</span>)</a>
<a class="sourceLine" id="cb81-2" data-line-number="2">nlat &lt;-<span class="st"> </span><span class="kw">dim</span>(lat)</a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="kw">head</span>(lat)</a></code></pre></div>
<pre><code>## [1] 88 86 84 82 80 78</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">c</span>(nlon,nlat))</a></code></pre></div>
<pre><code>## [1] 180  89</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="co"># get time</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2">time &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb85-3" data-line-number="3">tunits &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,<span class="st">&quot;time&quot;</span>,<span class="st">&quot;units&quot;</span>)</a>
<a class="sourceLine" id="cb85-4" data-line-number="4">nt &lt;-<span class="st"> </span><span class="kw">dim</span>(time)</a>
<a class="sourceLine" id="cb85-5" data-line-number="5">nt; tunits</a></code></pre></div>
<pre><code>## [1] 1983</code></pre>
<pre><code>## $hasatt
## [1] TRUE
## 
## $value
## [1] &quot;days since 1800-1-1 00:00:00&quot;</code></pre>
<p>Note that longitudes run from 0 to 360 degrees E, while latitudes run from 90 N to 90 S. The the N to S layout of latitudes (and of the data) will require various flipping of data arrays later.</p>
<p>Convert time:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="co"># convert time -- split the time units string into fields</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2">tustr &lt;-<span class="st"> </span><span class="kw">strsplit</span>(tunits<span class="op">$</span>value, <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3">ptime &lt;-<span class="st"> </span><span class="kw">convertDateNcdf2R</span>(time, <span class="kw">unlist</span>(tustr)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb88-4" data-line-number="4">  <span class="dt">origin =</span> <span class="kw">as.POSIXct</span>(<span class="kw">unlist</span>(tustr)[<span class="dv">3</span>],                                                <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>), <span class="dt">time.format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="kw">head</span>(time); <span class="kw">tail</span>(time)</a></code></pre></div>
<pre><code>## [1] 19723 19754 19782 19813 19843 19874</code></pre>
<pre><code>## [1] 79896 79927 79957 79988 80019 80047</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">head</span>(ptime); <span class="kw">tail</span>(ptime)</a></code></pre></div>
<pre><code>## [1] &quot;1854-01-01 UTC&quot; &quot;1854-02-01 UTC&quot; &quot;1854-03-01 UTC&quot; &quot;1854-04-01 UTC&quot; &quot;1854-05-01 UTC&quot; &quot;1854-06-01 UTC&quot;</code></pre>
<pre><code>## [1] &quot;2018-10-01 UTC&quot; &quot;2018-11-01 UTC&quot; &quot;2018-12-01 UTC&quot; &quot;2019-01-01 UTC&quot; &quot;2019-02-01 UTC&quot; &quot;2019-03-01 UTC&quot;</code></pre>
<p>Now get the SST data</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="co"># get monthly SSTs</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2">SST_mon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,dname_mon)</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">dlname_mon &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname_mon,<span class="st">&quot;long_name&quot;</span>)</a>
<a class="sourceLine" id="cb94-4" data-line-number="4">dunits_mon &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname_mon,<span class="st">&quot;units&quot;</span>)</a>
<a class="sourceLine" id="cb94-5" data-line-number="5">fillvalue_mon &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname_mon,<span class="st">&quot;_FillValue&quot;</span>)</a>
<a class="sourceLine" id="cb94-6" data-line-number="6"><span class="kw">dim</span>(SST_mon)</a></code></pre></div>
<pre><code>## [1]  180   89 1983</code></pre>
<p>Close the netCDF file:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="co"># close the monthly data file</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="kw">nc_close</span>(ncin)</a></code></pre></div>
<p>Flip the latitudes and data so that the data are layed out with the origin in the “lower left” of the map:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="co"># flip N-S</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2">temp_lat &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, nlat)</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">temp_lat[<span class="dv">1</span><span class="op">:</span>nlat] &lt;-<span class="st"> </span>lat[nlat<span class="op">:</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb97-4" data-line-number="4">temp_lat</a></code></pre></div>
<pre><code>##  [1] -88 -86 -84 -82 -80 -78 -76 -74 -72 -70 -68 -66 -64 -62 -60 -58 -56 -54 -52 -50 -48 -46 -44 -42 -40
## [26] -38 -36 -34 -32 -30 -28 -26 -24 -22 -20 -18 -16 -14 -12 -10  -8  -6  -4  -2   0   2   4   6   8  10
## [51]  12  14  16  18  20  22  24  26  28  30  32  34  36  38  40  42  44  46  48  50  52  54  56  58  60
## [76]  62  64  66  68  70  72  74  76  78  80  82  84  86  88</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">lat &lt;-<span class="st"> </span>temp_lat</a>
<a class="sourceLine" id="cb99-2" data-line-number="2"></a>
<a class="sourceLine" id="cb99-3" data-line-number="3">temp_array &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw">c</span>(nlon, nlat, nt))</a>
<a class="sourceLine" id="cb99-4" data-line-number="4">temp_array[<span class="dv">1</span><span class="op">:</span>nlon, <span class="dv">1</span><span class="op">:</span>nlat, <span class="dv">1</span><span class="op">:</span>nt] &lt;-<span class="st">  </span>SST_mon[<span class="dv">1</span><span class="op">:</span>nlon, nlat<span class="op">:</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span>nt] </a>
<a class="sourceLine" id="cb99-5" data-line-number="5">SST_mon &lt;-<span class="st"> </span>temp_array</a></code></pre></div>
<p>Note that in many cases, it’s desireable to have longitudes run from -180 to 180. This could be done by using the following code, but in the current example, this is NOT done to facilitate looking at plots focused on the Pacific.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="co"># rotate 0 to 360 to -180 to +180</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2">temp_lon &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, nlon)</a>
<a class="sourceLine" id="cb100-3" data-line-number="3">temp_lon[<span class="dv">1</span><span class="op">:</span>(nlon<span class="op">/</span><span class="dv">2</span>)] &lt;-<span class="st">  </span>lon[((nlon<span class="op">/</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>nlon] <span class="op">-</span><span class="st"> </span><span class="fl">360.0</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4">temp_lon[((nlon<span class="op">/</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>nlon] &lt;-<span class="st">  </span>lon[<span class="dv">1</span><span class="op">:</span>(nlon<span class="op">/</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb100-5" data-line-number="5">temp_lon</a>
<a class="sourceLine" id="cb100-6" data-line-number="6">lon &lt;-<span class="st"> </span>temp_lon</a>
<a class="sourceLine" id="cb100-7" data-line-number="7"></a>
<a class="sourceLine" id="cb100-8" data-line-number="8">temp_array &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw">c</span>(nlon, nlat, nt))</a>
<a class="sourceLine" id="cb100-9" data-line-number="9">temp_array[<span class="dv">1</span><span class="op">:</span>(nlon<span class="op">/</span><span class="dv">2</span>), <span class="dv">1</span><span class="op">:</span>nlat, <span class="dv">1</span><span class="op">:</span>nt] &lt;-<span class="st">  </span>SST_mon[((nlon<span class="op">/</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>nlon, nlat<span class="op">:</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span>nt] </a>
<a class="sourceLine" id="cb100-10" data-line-number="10">temp_array[((nlon<span class="op">/</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>nlon, <span class="dv">1</span><span class="op">:</span>nlat, <span class="dv">1</span><span class="op">:</span>nt] &lt;-<span class="st">  </span>SST_mon[<span class="dv">1</span><span class="op">:</span>(nlon<span class="op">/</span><span class="dv">2</span>), nlat<span class="op">:</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span>nt]</a>
<a class="sourceLine" id="cb100-11" data-line-number="11">SST_mon &lt;-<span class="st"> </span>temp_array</a></code></pre></div>
<p>Get a levelplot to check that the data has been read correctly:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="co"># levelplot </span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb101-3" data-line-number="3">grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lon=</span>lon, <span class="dt">lat=</span>lat)</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">cutpts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">25</span>,<span class="dv">35</span>)</a>
<a class="sourceLine" id="cb101-5" data-line-number="5">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(SST_mon[,, n] <span class="op">~</span><span class="st"> </span>lon <span class="op">*</span><span class="st"> </span>lat, <span class="dt">data=</span>grid, <span class="dt">at=</span>cutpts, <span class="dt">cuts=</span><span class="dv">11</span>, <span class="dt">pretty=</span>T, </a>
<a class="sourceLine" id="cb101-6" data-line-number="6">          <span class="dt">col.regions=</span>(<span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">10</span>,<span class="st">&quot;RdBu&quot;</span>))))</a>
<a class="sourceLine" id="cb101-7" data-line-number="7">plt <span class="op">+</span><span class="st"> </span>latticeExtra<span class="op">::</span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(coast_outline, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>))</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/h1levelplot%60-1.png" width="75%" height="75%" /></p>
<p>Inspection of the time range of the data reveals that there are few months from 2019 in the data array. Get rid of these</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="co"># chop off last three months of the data, and also the time variables</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2">SST_mon &lt;-<span class="st"> </span>SST_mon[,, <span class="dv">1</span><span class="op">:</span>(nt<span class="dv">-3</span>)]</a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="kw">dim</span>(SST_mon)</a></code></pre></div>
<pre><code>## [1]  180   89 1980</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">time &lt;-<span class="st"> </span>time[<span class="dv">1</span><span class="op">:</span>(nt<span class="dv">-3</span>)]</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">ptime &lt;-<span class="st"> </span>ptime[<span class="dv">1</span><span class="op">:</span>(nt<span class="dv">-3</span>)]</a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="kw">head</span>(ptime); <span class="kw">tail</span>(ptime)</a></code></pre></div>
<pre><code>## [1] &quot;1854-01-01 UTC&quot; &quot;1854-02-01 UTC&quot; &quot;1854-03-01 UTC&quot; &quot;1854-04-01 UTC&quot; &quot;1854-05-01 UTC&quot; &quot;1854-06-01 UTC&quot;</code></pre>
<pre><code>## [1] &quot;2018-07-01 UTC&quot; &quot;2018-08-01 UTC&quot; &quot;2018-09-01 UTC&quot; &quot;2018-10-01 UTC&quot; &quot;2018-11-01 UTC&quot; &quot;2018-12-01 UTC&quot;</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">nt &lt;-<span class="st"> </span>nt <span class="op">-</span><span class="st"> </span><span class="dv">3</span></a></code></pre></div>
<p>Now get the long-term means (which have the same longitudes and latitudes as the monthly values, so no need to get those).:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="co"># get SSTs ltms</span></a>
<a class="sourceLine" id="cb108-2" data-line-number="2">SST_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/nc_files/&quot;</span></a>
<a class="sourceLine" id="cb108-3" data-line-number="3">SST_ltm_name &lt;-<span class="st"> &quot;NOAA_ERSSTv5_sst.mon.ltm.1981-2010.nc&quot;</span></a>
<a class="sourceLine" id="cb108-4" data-line-number="4">SST_ltm_file &lt;-<span class="st"> </span><span class="kw">paste</span>(SST_path, SST_ltm_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb108-5" data-line-number="5">dname_ltm &lt;-<span class="st"> &quot;sst&quot;</span></a>
<a class="sourceLine" id="cb108-6" data-line-number="6"></a>
<a class="sourceLine" id="cb108-7" data-line-number="7"><span class="co"># open a netCDF file</span></a>
<a class="sourceLine" id="cb108-8" data-line-number="8">ncin &lt;-<span class="st"> </span><span class="kw">nc_open</span>(SST_ltm_file)</a>
<a class="sourceLine" id="cb108-9" data-line-number="9"><span class="co">#print(ncin)</span></a>
<a class="sourceLine" id="cb108-10" data-line-number="10"></a>
<a class="sourceLine" id="cb108-11" data-line-number="11"><span class="co"># get time</span></a>
<a class="sourceLine" id="cb108-12" data-line-number="12">time &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,<span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb108-13" data-line-number="13">tunits &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,<span class="st">&quot;time&quot;</span>,<span class="st">&quot;units&quot;</span>)</a>
<a class="sourceLine" id="cb108-14" data-line-number="14">nm &lt;-<span class="st"> </span><span class="kw">dim</span>(time)</a>
<a class="sourceLine" id="cb108-15" data-line-number="15">nm; tunits</a></code></pre></div>
<pre><code>## [1] 12</code></pre>
<pre><code>## $hasatt
## [1] TRUE
## 
## $value
## [1] &quot;days since 1800-1-1 00:00:00&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">SST_ltm &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(ncin,dname_ltm)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2">dlname_ltm &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname_ltm,<span class="st">&quot;long_name&quot;</span>)</a>
<a class="sourceLine" id="cb111-3" data-line-number="3">dunits_ltm &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname_ltm,<span class="st">&quot;units&quot;</span>)</a>
<a class="sourceLine" id="cb111-4" data-line-number="4">fillvalue_ltm &lt;-<span class="st"> </span><span class="kw">ncatt_get</span>(ncin,dname_ltm,<span class="st">&quot;_FillValue&quot;</span>)</a>
<a class="sourceLine" id="cb111-5" data-line-number="5"><span class="kw">dim</span>(SST_ltm)</a></code></pre></div>
<pre><code>## [1] 180  89  12</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="co"># close the monthly data file</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="kw">nc_close</span>(ncin)</a></code></pre></div>
<p>Flip the data (but not the latitudes; they are already in the right order):</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="co"># flip N-S</span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2">temp_array &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw">c</span>(nlon, nlat, nm))</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">temp_array[<span class="dv">1</span><span class="op">:</span>nlon, <span class="dv">1</span><span class="op">:</span>nlat, <span class="dv">1</span><span class="op">:</span>nm] &lt;-<span class="st">  </span>SST_ltm[<span class="dv">1</span><span class="op">:</span>nlon, nlat<span class="op">:</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span>nm] </a>
<a class="sourceLine" id="cb114-4" data-line-number="4">SST_ltm &lt;-<span class="st"> </span>temp_array</a></code></pre></div>
<p>Again, the data could also be rotated, but that’s not done here:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="co"># # rotate 0 to 360 to -180 to +180</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="co"># temp_lon &lt;- rep(NA, nlon)</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="co"># temp_lon[1:(nlon/2)] &lt;-  lon[((nlon/2)+1):nlon] - 360.0</span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="co"># temp_lon[((nlon/2)+1):nlon] &lt;-  lon[1:(nlon/2)]</span></a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="co"># temp_lon</span></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="co"># lon &lt;- temp_lon</span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7"><span class="co"># </span></a>
<a class="sourceLine" id="cb115-8" data-line-number="8"><span class="co"># temp_array &lt;- array(NA, dim = c(nlon, nlat, nt))</span></a>
<a class="sourceLine" id="cb115-9" data-line-number="9"><span class="co"># temp_array[1:(nlon/2), 1:nlat, 1:nt] &lt;-  SST_ltm[((nlon/2)+1):nlon, nlat:1, 1:nt] </span></a>
<a class="sourceLine" id="cb115-10" data-line-number="10"><span class="co"># temp_array[((nlon/2)+1):nlon, 1:nlat, 1:nt] &lt;-  SST_ltm[1:(nlon/2), nlat:1, 1:nt]</span></a>
<a class="sourceLine" id="cb115-11" data-line-number="11"><span class="co"># SST_ltm &lt;- temp_array</span></a></code></pre></div>
<p>Map the data to check that it’s been read in ok:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="co"># levelplot </span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">8</span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3">grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lon=</span>lon, <span class="dt">lat=</span>lat)</a>
<a class="sourceLine" id="cb116-4" data-line-number="4">cutpts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">25</span>,<span class="dv">35</span>)</a>
<a class="sourceLine" id="cb116-5" data-line-number="5">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(SST_ltm[,, n] <span class="op">~</span><span class="st"> </span>lon <span class="op">*</span><span class="st"> </span>lat, <span class="dt">data=</span>grid, <span class="dt">at=</span>cutpts, <span class="dt">cuts=</span><span class="dv">11</span>, <span class="dt">pretty=</span>T, </a>
<a class="sourceLine" id="cb116-6" data-line-number="6">                 <span class="dt">col.regions=</span>(<span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">10</span>,<span class="st">&quot;RdBu&quot;</span>))))</a>
<a class="sourceLine" id="cb116-7" data-line-number="7">plt <span class="op">+</span><span class="st"> </span>latticeExtra<span class="op">::</span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(coast_outline, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>))</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/h1levelplot2-1.png" width="75%" height="75%" /></p>
<p>Get the beginning and ending years</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="co"># get beginning year and ending year</span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2">beg_date &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">as.character</span>(ptime[<span class="dv">1</span>]), <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb117-3" data-line-number="3">beg_yr &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">as.character</span>(beg_date), <span class="st">&quot;-&quot;</span>))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb117-4" data-line-number="4">beg_yr</a></code></pre></div>
<pre><code>## [1] 1854</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">end_date &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">as.character</span>(ptime[nt]), <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb119-2" data-line-number="2">end_yr &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">as.character</span>(end_date), <span class="st">&quot;-&quot;</span>))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb119-3" data-line-number="3">end_yr</a></code></pre></div>
<pre><code>## [1] 2018</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">nyrs &lt;-<span class="st"> </span>end_yr <span class="op">-</span><span class="st"> </span>beg_yr <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2">nyrs</a></code></pre></div>
<pre><code>## [1] 165</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="co"># # generate a decimal year (&quot;YrMn&quot;) time coordinate</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="co"># YrMn &lt;- seq(beg_yr, end_yr+1-(1/12), by=(1/12))</span></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="co"># length(YrMn)</span></a>
<a class="sourceLine" id="cb123-4" data-line-number="4"><span class="co"># head(YrMn); tail(YrMn)</span></a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="co"># </span></a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="co"># # year</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7"><span class="co"># year &lt;- as.integer(YrMn)</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="co"># head(year); tail(year)</span></a></code></pre></div>
<p>Now get the anomalies:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="co"># get anomalies</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2">SST_anm &lt;-<span class="st"> </span>SST_mon <span class="op">-</span><span class="st"> </span><span class="kw">rep</span>(SST_ltm, nyrs)</a></code></pre></div>
<p>Map the data to check the anomalies:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="co"># levelplot </span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2">n &lt;-<span class="st"> </span>nt</a>
<a class="sourceLine" id="cb125-3" data-line-number="3">grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lon=</span>lon, <span class="dt">lat=</span>lat)</a>
<a class="sourceLine" id="cb125-4" data-line-number="4">cutpts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span>.<span class="dv">5</span>,<span class="op">-</span>.<span class="dv">2</span>,<span class="op">-</span>.<span class="dv">1</span>,<span class="dv">0</span>,.<span class="dv">1</span>,.<span class="dv">2</span>,.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb125-5" data-line-number="5">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(SST_anm[,, n] <span class="op">~</span><span class="st"> </span>lon <span class="op">*</span><span class="st"> </span>lat, <span class="dt">data=</span>grid, <span class="dt">at=</span>cutpts, <span class="dt">cuts=</span><span class="dv">11</span>, <span class="dt">pretty=</span>T, </a>
<a class="sourceLine" id="cb125-6" data-line-number="6">                 <span class="dt">col.regions=</span>(<span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">10</span>,<span class="st">&quot;RdBu&quot;</span>))))</a>
<a class="sourceLine" id="cb125-7" data-line-number="7">plt <span class="op">+</span><span class="st"> </span>latticeExtra<span class="op">::</span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(coast_outline, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>))</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/h1levelplot3-1.png" width="75%" height="75%" /></p>
<p>The first Hovmöller plot attempts to reproduce the NOAA ESRL PSD Hovmöller plot of tropical Pacific temperatures between 3.5 S and 3.5 N along a transect from the Indian ocean to the eastern Pacific <a href="https://www.esrl.noaa.gov/psd/map/images/sst/sst.month.anom.hov.io.gif">[View Plot]</a>. Set up for selecting those data by getting the longitude <code>j</code> and latitude <code>k</code> indices of the bounding box:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="co"># get tropical Pacific</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2">tlon_min &lt;-<span class="st"> </span><span class="dv">40</span>; tlon_max &lt;-<span class="st"> </span><span class="dv">280</span>; tlat_min &lt;-<span class="st"> </span><span class="dv">-4</span>; tlat_max &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3">jmin &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlon_min <span class="op">-</span><span class="st"> </span>lon))</a>
<a class="sourceLine" id="cb126-4" data-line-number="4">jmax &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlon_max <span class="op">-</span><span class="st"> </span>lon))</a>
<a class="sourceLine" id="cb126-5" data-line-number="5">jmin; lon[jmin]; jmax; lon[jmax]</a></code></pre></div>
<pre><code>## [1] 21</code></pre>
<pre><code>## [1] 40</code></pre>
<pre><code>## [1] 141</code></pre>
<pre><code>## [1] 280</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">kmin &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlat_min <span class="op">-</span><span class="st"> </span>lat))</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">kmax &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlat_max <span class="op">-</span><span class="st"> </span>lat))</a>
<a class="sourceLine" id="cb131-3" data-line-number="3">kmin; lat[kmin]; kmax; lat[kmax]</a></code></pre></div>
<pre><code>## [1] 43</code></pre>
<pre><code>## [1] -4</code></pre>
<pre><code>## [1] 47</code></pre>
<pre><code>## [1] 4</code></pre>
<p>Now create a raster brick from the 3-D array of anomalies, selecting data from the Pacific region just defined. Also just get data from 1989 onwards:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="co"># tropical pacific</span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2">SST_raster &lt;-<span class="st"> </span><span class="kw">brick</span>(SST_anm[jmin<span class="op">:</span>jmax, kmax<span class="op">:</span>kmin, <span class="dv">1621</span><span class="op">:</span>nt], </a>
<a class="sourceLine" id="cb136-3" data-line-number="3">                    <span class="dt">xmn=</span>lon[jmin], <span class="dt">xmx=</span>lon[jmax], <span class="dt">ymn=</span>lat[kmin], <span class="dt">ymx=</span>lat[kmax],</a>
<a class="sourceLine" id="cb136-4" data-line-number="4">                    <span class="dt">transpose=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb136-5" data-line-number="5">                    <span class="dt">crs=</span><span class="st">&quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;</span>)</a>
<a class="sourceLine" id="cb136-6" data-line-number="6">SST_raster</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 5, 121, 605, 360  (nrow, ncol, ncell, nlayers)
## resolution  : 1.983471, 1.6  (x, y)
## extent      : 40, 280, -4, 4  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       :      layer.1,      layer.2,      layer.3,      layer.4,      layer.5,      layer.6,      layer.7,      layer.8,      layer.9,     layer.10,     layer.11,     layer.12,     layer.13,     layer.14,     layer.15, ... 
## min values  : -2.369419098, -2.215007782, -1.634376526, -1.275438309, -1.187150955, -1.170444489, -1.187540054, -0.972883224, -0.894659042, -0.723871231, -0.934144974, -0.985055923, -0.846725464, -0.291933060, -0.687570572, ... 
## max values  :   0.40519524,   0.28303909,   0.34576988,   0.30479622,   0.36996269,   0.72554016,   0.79590607,   0.76388931,   0.67235374,   0.84916687,   0.34784508,   0.56470108,   0.53544807,   0.82624435,   0.86936188, ...</code></pre>
<p>Replace the layer names with appropriate date labels:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">idx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">as.Date</span>(ptime[<span class="dv">1621</span>]), <span class="kw">as.Date</span>(ptime[nt]), <span class="dt">by=</span><span class="st">&#39;month&#39;</span>)</a>
<a class="sourceLine" id="cb138-2" data-line-number="2">idx &lt;-<span class="st"> </span><span class="kw">as.yearmon</span>(idx)</a>
<a class="sourceLine" id="cb138-3" data-line-number="3">SST_raster &lt;-<span class="st"> </span><span class="kw">setZ</span>(SST_raster, idx, <span class="dt">name=</span><span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="kw">names</span>(SST_raster) &lt;-<span class="st"> </span><span class="kw">as.character</span>(idx)</a>
<a class="sourceLine" id="cb138-5" data-line-number="5">SST_raster</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 5, 121, 605, 360  (nrow, ncol, ncell, nlayers)
## resolution  : 1.983471, 1.6  (x, y)
## extent      : 40, 280, -4, 4  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       :     Jan.1989,     Feb.1989,     Mar.1989,     Apr.1989,     May.1989,     Jun.1989,     Jul.1989,     Aug.1989,     Sep.1989,     Oct.1989,     Nov.1989,     Dec.1989,     Jan.1990,     Feb.1990,     Mar.1990, ... 
## min values  : -2.369419098, -2.215007782, -1.634376526, -1.275438309, -1.187150955, -1.170444489, -1.187540054, -0.972883224, -0.894659042, -0.723871231, -0.934144974, -0.985055923, -0.846725464, -0.291933060, -0.687570572, ... 
## max values  :   0.40519524,   0.28303909,   0.34576988,   0.30479622,   0.36996269,   0.72554016,   0.79590607,   0.76388931,   0.67235374,   0.84916687,   0.34784508,   0.56470108,   0.53544807,   0.82624435,   0.86936188, ... 
## time        : Jan 1989, Dec 2018 (min, max)</code></pre>
<p>Here’s the Hovmöller plot:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="kw">hovmoller</span>(SST_raster,</a>
<a class="sourceLine" id="cb140-2" data-line-number="2">      <span class="dt">dirXY =</span> x,</a>
<a class="sourceLine" id="cb140-3" data-line-number="3">      <span class="dt">at =</span> <span class="kw">do.breaks</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>),<span class="dv">16</span>),</a>
<a class="sourceLine" id="cb140-4" data-line-number="4">      <span class="dt">contour=</span><span class="ot">FALSE</span>, <span class="dt">interpolate=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb140-5" data-line-number="5">      <span class="dt">par.settings=</span><span class="kw">RdBuTheme</span>(<span class="dt">region=</span><span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&#39;RdBu&#39;</span>))),</a>
<a class="sourceLine" id="cb140-6" data-line-number="6">      <span class="dt">main=</span><span class="st">&quot;Tropical Pacific SST Anomalies&quot;</span> )</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/hov1-1.png" width="75%" height="75%" /></p>
<p>Note that data for the globe could have been selected as follows</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="co"># globe</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2">SST_raster &lt;-<span class="st"> </span><span class="kw">brick</span>(SST_anm[<span class="dv">1</span><span class="op">:</span>nlon, nlat<span class="op">:</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span>nt],</a>
<a class="sourceLine" id="cb141-3" data-line-number="3">                    <span class="dt">xmn=</span>lon[<span class="dv">1</span>], <span class="dt">xmx=</span>lon[nlon], <span class="dt">ymn=</span>lat[<span class="dv">1</span>], <span class="dt">ymx=</span>lat[nlat],</a>
<a class="sourceLine" id="cb141-4" data-line-number="4">                    <span class="dt">transpose=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb141-5" data-line-number="5">                    <span class="dt">crs=</span><span class="st">&quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;</span>)</a>
<a class="sourceLine" id="cb141-6" data-line-number="6">SST_raster</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 180, 89, 16020, 1980  (nrow, ncol, ncell, nlayers)
## resolution  : 4.022472, 0.9777778  (x, y)
## extent      : 0, 358, -88, 88  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       :    layer.1,    layer.2,    layer.3,    layer.4,    layer.5,    layer.6,    layer.7,    layer.8,    layer.9,   layer.10,   layer.11,   layer.12,   layer.13,   layer.14,   layer.15, ... 
## min values  :  -5.531379,  -4.315210,  -2.955016,  -5.273472,  -4.548075,  -6.273916,  -5.721573,  -5.741785,  -3.653784,  -3.328945,  -2.681358,  -3.870991,  -2.346174,  -3.445217,  -3.578811, ... 
## max values  :   2.932791,   3.860547,   3.462628,   4.640805,   3.595255,   3.440714,   5.761877,   2.980705,   3.797678,   4.062496,   4.802368,   2.918524,   3.329120,   3.470642,   4.478282, ...</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">idx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">as.Date</span>(ptime[<span class="dv">1</span>]), <span class="kw">as.Date</span>(ptime[nt]), <span class="dt">by=</span><span class="st">&#39;month&#39;</span>)</a>
<a class="sourceLine" id="cb143-2" data-line-number="2">idx &lt;-<span class="st"> </span><span class="kw">as.yearmon</span>(idx)</a>
<a class="sourceLine" id="cb143-3" data-line-number="3">SST_raster &lt;-<span class="st"> </span><span class="kw">setZ</span>(SST_raster, idx, <span class="dt">name=</span><span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb143-4" data-line-number="4"><span class="kw">names</span>(SST_raster) &lt;-<span class="st"> </span><span class="kw">as.character</span>(idx)</a>
<a class="sourceLine" id="cb143-5" data-line-number="5">SST_raster</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 180, 89, 16020, 1980  (nrow, ncol, ncell, nlayers)
## resolution  : 4.022472, 0.9777778  (x, y)
## extent      : 0, 358, -88, 88  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       :   Jan.1854,   Feb.1854,   Mar.1854,   Apr.1854,   May.1854,   Jun.1854,   Jul.1854,   Aug.1854,   Sep.1854,   Oct.1854,   Nov.1854,   Dec.1854,   Jan.1855,   Feb.1855,   Mar.1855, ... 
## min values  :  -5.531379,  -4.315210,  -2.955016,  -5.273472,  -4.548075,  -6.273916,  -5.721573,  -5.741785,  -3.653784,  -3.328945,  -2.681358,  -3.870991,  -2.346174,  -3.445217,  -3.578811, ... 
## max values  :   2.932791,   3.860547,   3.462628,   4.640805,   3.595255,   3.440714,   5.761877,   2.980705,   3.797678,   4.062496,   4.802368,   2.918524,   3.329120,   3.470642,   4.478282, ... 
## time        : Jan 1854, Dec 2018 (min, max)</code></pre>
</div>
<div id="horizon-plot" class="section level2">
<h2><span class="header-section-number">4.2</span> Horizon plot</h2>
<p>The horizon plot plots multiple time series (here average values for individual latitudinal zones) in a way that allows common trends to be visualized. For this example, select a more latitudinally extensive chunk of data:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="co"># horizon plot</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="co"># get tropical Pacific</span></a>
<a class="sourceLine" id="cb145-3" data-line-number="3">tlon_min &lt;-<span class="st"> </span><span class="dv">178</span>; tlon_max &lt;-<span class="st"> </span><span class="dv">290</span>; tlat_min &lt;-<span class="st"> </span><span class="dv">-30</span>; tlat_max &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb145-4" data-line-number="4">jmin &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlon_min <span class="op">-</span><span class="st"> </span>lon))</a>
<a class="sourceLine" id="cb145-5" data-line-number="5">jmax &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlon_max <span class="op">-</span><span class="st"> </span>lon))</a>
<a class="sourceLine" id="cb145-6" data-line-number="6">jmin; lon[jmin]; jmax; lon[jmax]</a></code></pre></div>
<pre><code>## [1] 90</code></pre>
<pre><code>## [1] 178</code></pre>
<pre><code>## [1] 146</code></pre>
<pre><code>## [1] 290</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">kmin &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlat_min <span class="op">-</span><span class="st"> </span>lat))</a>
<a class="sourceLine" id="cb150-2" data-line-number="2">kmax &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">abs</span>(tlat_max <span class="op">-</span><span class="st"> </span>lat))</a>
<a class="sourceLine" id="cb150-3" data-line-number="3">kmin; lat[kmin]; kmax; lat[kmax]</a></code></pre></div>
<pre><code>## [1] 30</code></pre>
<pre><code>## [1] -30</code></pre>
<pre><code>## [1] 60</code></pre>
<pre><code>## [1] 30</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="co"># tropical pacific</span></a>
<a class="sourceLine" id="cb155-2" data-line-number="2">SST_raster &lt;-<span class="st"> </span><span class="kw">brick</span>(SST_anm[jmin<span class="op">:</span>jmax, kmax<span class="op">:</span>kmin, <span class="dv">1621</span><span class="op">:</span>nt], </a>
<a class="sourceLine" id="cb155-3" data-line-number="3">                    <span class="dt">xmn=</span>lon[jmin], <span class="dt">xmx=</span>lon[jmax], <span class="dt">ymn=</span>lat[kmin], <span class="dt">ymx=</span>lat[kmax],</a>
<a class="sourceLine" id="cb155-4" data-line-number="4">                    <span class="dt">transpose=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb155-5" data-line-number="5">                    <span class="dt">crs=</span><span class="st">&quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;</span>)</a>
<a class="sourceLine" id="cb155-6" data-line-number="6">SST_raster</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 31, 57, 1767, 360  (nrow, ncol, ncell, nlayers)
## resolution  : 1.964912, 1.935484  (x, y)
## extent      : 178, 290, -30, 30  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       :    layer.1,    layer.2,    layer.3,    layer.4,    layer.5,    layer.6,    layer.7,    layer.8,    layer.9,   layer.10,   layer.11,   layer.12,   layer.13,   layer.14,   layer.15, ... 
## min values  : -2.4305210, -2.2150078, -1.6343765, -1.2754383, -1.3796940, -1.4751682, -1.1875401, -0.9724255, -0.9224682, -0.9408112, -0.9465122, -1.0817566, -1.1374607, -2.2438545, -1.4876442, ... 
## max values  :  1.7494316,  1.8365631,  1.4213772,  1.4168472,  1.2032204,  0.8245010,  1.2394390,  1.0155792,  0.7823792,  0.4477158,  0.5992851,  0.8868752,  0.7261028,  0.8262444,  0.9126644, ...</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">idx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">as.Date</span>(ptime[<span class="dv">1621</span>]), <span class="kw">as.Date</span>(ptime[nt]), <span class="dt">by=</span><span class="st">&#39;month&#39;</span>)</a>
<a class="sourceLine" id="cb157-2" data-line-number="2">idx &lt;-<span class="st"> </span><span class="kw">as.yearmon</span>(idx)</a>
<a class="sourceLine" id="cb157-3" data-line-number="3">SST_raster &lt;-<span class="st"> </span><span class="kw">setZ</span>(SST_raster, idx, <span class="dt">name=</span><span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb157-4" data-line-number="4"><span class="kw">names</span>(SST_raster) &lt;-<span class="st"> </span><span class="kw">as.character</span>(idx)</a>
<a class="sourceLine" id="cb157-5" data-line-number="5">SST_raster</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 31, 57, 1767, 360  (nrow, ncol, ncell, nlayers)
## resolution  : 1.964912, 1.935484  (x, y)
## extent      : 178, 290, -30, 30  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       :   Jan.1989,   Feb.1989,   Mar.1989,   Apr.1989,   May.1989,   Jun.1989,   Jul.1989,   Aug.1989,   Sep.1989,   Oct.1989,   Nov.1989,   Dec.1989,   Jan.1990,   Feb.1990,   Mar.1990, ... 
## min values  : -2.4305210, -2.2150078, -1.6343765, -1.2754383, -1.3796940, -1.4751682, -1.1875401, -0.9724255, -0.9224682, -0.9408112, -0.9465122, -1.0817566, -1.1374607, -2.2438545, -1.4876442, ... 
## max values  :  1.7494316,  1.8365631,  1.4213772,  1.4168472,  1.2032204,  0.8245010,  1.2394390,  1.0155792,  0.7823792,  0.4477158,  0.5992851,  0.8868752,  0.7261028,  0.8262444,  0.9126644, ... 
## time        : Jan 1989, Dec 2018 (min, max)</code></pre>
<p>Here’s the horizon plot:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="co"># horizonplot -- rasterVis example</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2"><span class="kw">horizonplot</span>(SST_raster, <span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>,<span class="dt">col.regions=</span><span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dt">n=</span><span class="dv">8</span>, <span class="st">&#39;RdBu&#39;</span>)) )</a></code></pre></div>
<p><img src="rasterVis01_files/figure-html/horizon-1.png" width="75%" height="75%" /></p>
</div>
<div id="hovmoller-plots-a-second-example" class="section level2">
<h2><span class="header-section-number">4.3</span> Hovmöller plots – a second example</h2>
<p>This second example shows how a Hovmöller plot can be written directly to a .png file, which may be useful when it takes a while to generate. The data here are a combined set of land and ocean temperature anomalies from 1850 through the beginning of 2019.</p>
<p>Use the <code>brick()</code> function in <code>raster</code> to read the data.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># HADCRUT4 Combined Air Temperature/SST Anomalies</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="co"># read a 3-D netCDF dataset</span></a>
<a class="sourceLine" id="cb160-3" data-line-number="3">hadcrut_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/nc_files/&quot;</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4">hadcrut_name &lt;-<span class="st"> &quot;HadCRUT.4.6.0.0.median.nc&quot;</span></a>
<a class="sourceLine" id="cb160-5" data-line-number="5">hadcrut_file &lt;-<span class="st"> </span><span class="kw">paste</span>(hadcrut_path, hadcrut_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb160-6" data-line-number="6">hadcrut &lt;-<span class="st"> </span><span class="kw">brick</span>(hadcrut_file) <span class="co"># open air.mon.anom.nc</span></a>
<a class="sourceLine" id="cb160-7" data-line-number="7"></a>
<a class="sourceLine" id="cb160-8" data-line-number="8">hadcrut</a></code></pre></div>
<pre><code>## class       : RasterBrick 
## dimensions  : 36, 72, 2592, 2030  (nrow, ncol, ncell, nlayers)
## resolution  : 5, 5  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/bartlein/Projects/ESSD/data/nc_files/HadCRUT.4.6.0.0.median.nc 
## names       : X1850.01.16, X1850.02.15, X1850.03.16, X1850.04.16, X1850.05.16, X1850.06.16, X1850.07.16, X1850.08.16, X1850.09.16, X1850.10.16, X1850.11.16, X1850.12.16, X1851.01.16, X1851.02.15, X1851.03.16, ... 
## Date        : 1850-01-16, 2019-02-15 (min, max)
## varname     : temperature_anomaly</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">c</span>(<span class="kw">filename</span>(hadcrut), <span class="kw">hasValues</span>(hadcrut), <span class="kw">inMemory</span>(hadcrut)))</a></code></pre></div>
<pre><code>## [1] &quot;/Users/bartlein/Projects/ESSD/data/nc_files/HadCRUT.4.6.0.0.median.nc&quot;
## [2] &quot;TRUE&quot;                                                                 
## [3] &quot;FALSE&quot;</code></pre>
<p>As before, replace the layer names (dates) with something more appropriate:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="co"># replace layer names</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2">idx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&#39;1850-01-01&#39;</span>), <span class="kw">as.Date</span>(<span class="st">&#39;2019-02-01&#39;</span>), <span class="st">&#39;month&#39;</span>)</a>
<a class="sourceLine" id="cb164-3" data-line-number="3">idx &lt;-<span class="st"> </span><span class="kw">as.yearmon</span>(idx)</a>
<a class="sourceLine" id="cb164-4" data-line-number="4">tmpplt &lt;-<span class="st"> </span><span class="kw">setZ</span>(hadcrut, idx)</a>
<a class="sourceLine" id="cb164-5" data-line-number="5"><span class="kw">names</span>(tmpplt) &lt;-<span class="st"> </span><span class="kw">as.character</span>(idx)</a></code></pre></div>
<p>Produce the plot, and send it to a <code>.png</code> file:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2">pngfile &lt;-<span class="st"> &quot;HadCRUTv4_hov.png&quot;</span></a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="kw">png</span>(pngfile, <span class="dt">width=</span><span class="dv">720</span>, <span class="dt">height=</span><span class="dv">720</span>) <span class="co"># open the file</span></a>
<a class="sourceLine" id="cb165-4" data-line-number="4"><span class="kw">hovmoller</span>(tmpplt, <span class="dt">dirXY=</span>y,</a>
<a class="sourceLine" id="cb165-5" data-line-number="5">      <span class="dt">at =</span> <span class="kw">do.breaks</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>),<span class="dv">16</span>),</a>
<a class="sourceLine" id="cb165-6" data-line-number="6">      <span class="dt">contour=</span><span class="ot">FALSE</span>, <span class="dt">interpolate=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb165-7" data-line-number="7">      <span class="dt">par.settings=</span><span class="kw">RdBuTheme</span>(<span class="dt">region=</span><span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&#39;RdBu&#39;</span>))),</a>
<a class="sourceLine" id="cb165-8" data-line-number="8">      <span class="dt">main=</span><span class="st">&quot;HadCRU Anomalies, (1961-1990 base period)&quot;</span> )</a>
<a class="sourceLine" id="cb165-9" data-line-number="9"><span class="co">#dev.off()</span></a></code></pre></div>
<p>Here’s what it looks like:</p>
<p><img src="HadCRUTv4_hov.png" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
