<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Maps in R (2)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="raster_intro.html">raster and netCDF in R</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="RMaps.html">Maps in R</a>
    </li>
    <li>
      <a href="RMaps2.html">Maps in R (2)</a>
    </li>
    <li>
      <a href="rasterVis01.html">Visualization:  raster and rasterVis</a>
    </li>
    <li>
      <a href="vis_ggplot01.html">Visualization for explanation</a>
    </li>
    <li>
      <a href="highdim.html">Visualization of high-dimensional data</a>
    </li>
    <li>
      <a href="PCA.html">Principal components analyses</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="geog495_ex01.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="packages-and-data.html">Install packages and data</a>
    </li>
    <li>
      <a href="GitHub.html">Git and GitHub</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF</a>
    </li>
    <li>
      <a href="install_Panoply.html">Install Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="project.html">GitHub project repository and web page</a>
    </li>
    <li>
      <a href="ltms-and-anomalies.html">Long-term means and anomalies</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Maps in R (2)</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#a-second-example"><span class="toc-section-number">1</span> A second example</a><ul>
<li><a href="#read-the-natural-earth-shapefiles"><span class="toc-section-number">1.1</span> Read the Natural Earth shapefiles</a></li>
<li><a href="#project-the-shape-files"><span class="toc-section-number">1.2</span> Project the shape files</a></li>
<li><a href="#write-out-the-projected-and-trimmed-shape-files"><span class="toc-section-number">1.3</span> Write out the projected and trimmed shape files</a></li>
</ul></li>
<li><a href="#map-of-north-american-shaded-relief"><span class="toc-section-number">2</span> Map of North American shaded relief</a><ul>
<li><a href="#read-the-read-the-projected-and-trimmed-shapefiles"><span class="toc-section-number">2.1</span> Read the read the projected and trimmed shapefiles</a></li>
<li><a href="#read-a-shaded-relief-file"><span class="toc-section-number">2.2</span> Read a shaded relief file</a></li>
<li><a href="#make-the-map"><span class="toc-section-number">2.3</span> Make the map</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="a-second-example" class="section level1">
<h1><span class="header-section-number">1</span> A second example</h1>
<p>This second example illustrates the creating of a base map for North America that conforms to the projection used for the <code>na10km_v2</code> data. As before, <em>Natural Earth</em> shapefiles are read and projected, this time using a Lambert Azimuthal Equal-Area projection, and trimmed to the appropriate region.</p>
<div id="read-the-natural-earth-shapefiles" class="section level2">
<h2><span class="header-section-number">1.1</span> Read the Natural Earth shapefiles</h2>
<p>Load the appropriate packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(maptools)</a></code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Checking rgeos availability: TRUE</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">library</span>(rgdal)</a></code></pre></div>
<pre><code>## rgdal: version: 1.4-3, (SVN revision 828)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.1.3, released 2017/20/01
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal/proj
##  Linking to sp version: 1.3-1</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">library</span>(rgeos)</a></code></pre></div>
<pre><code>## rgeos version: 0.4-3, (SVN revision 595)
##  GEOS runtime version: 3.6.1-CAPI-1.10.1 
##  Linking to sp version: 1.3-1 
##  Polygon checking: TRUE</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">library</span>(lattice)</a></code></pre></div>
<p>Set the shapefile names, including those for global coastlines, adminstrative units (borders). Set the filenames:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Natural Earth shape files -- global (Robinson) projections</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co"># get shapefiles from http://www.naturalearthdata.com</span></a>
<a class="sourceLine" id="cb9-3" title="3">shape_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/RMaps/source/&quot;</span></a>
<a class="sourceLine" id="cb9-4" title="4">coast_shapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(shape_path, <span class="st">&quot;ne_10m_coastline/ne_10m_coastline.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb9-5" title="5">admin0_shapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(shape_path, <span class="st">&quot;ne_10m_admin_0_countries/ne_10m_admin_0_countries.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb9-6" title="6">admin1_shapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(shape_path, <span class="st">&quot;ne_10m_admin_1_states_provinces_lakes/ne_10m_admin_1_states_provinces_lakes.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb9-7" title="7">lakes_shapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(shape_path, <span class="st">&quot;ne_10m_lakes/ne_10m_lakes.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>Read and plot the shapefiles (note: summary output is suppressed)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">layer &lt;-<span class="st"> </span><span class="kw">ogrListLayers</span>(coast_shapefile)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">ogrInfo</span>(coast_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-3" title="3">coast_lines &lt;-<span class="st"> </span><span class="kw">readOGR</span>(coast_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">summary</span>(coast_lines)  </a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">plot</span>(coast_lines)</a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7">layer &lt;-<span class="st"> </span><span class="kw">ogrListLayers</span>(admin0_shapefile)</a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">ogrInfo</span>(admin0_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-9" title="9">admin0_poly &lt;-<span class="st"> </span><span class="kw">readOGR</span>(admin0_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-10" title="10"><span class="kw">summary</span>(admin0_poly)  </a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">plot</span>(admin0_poly, <span class="dt">bor=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-12" title="12"></a>
<a class="sourceLine" id="cb10-13" title="13">layer &lt;-<span class="st"> </span><span class="kw">ogrListLayers</span>(admin1_shapefile)</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="kw">ogrInfo</span>(admin1_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-15" title="15">admin1_poly &lt;-<span class="st"> </span><span class="kw">readOGR</span>(admin1_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-16" title="16"><span class="kw">summary</span>(admin1_poly)  </a>
<a class="sourceLine" id="cb10-17" title="17"><span class="kw">plot</span>(admin1_poly, <span class="dt">bor=</span><span class="st">&quot;lightgreen&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19">layer &lt;-<span class="st"> </span><span class="kw">ogrListLayers</span>(lakes_shapefile)</a>
<a class="sourceLine" id="cb10-20" title="20"><span class="kw">ogrInfo</span>(lakes_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-21" title="21">lakes_poly &lt;-<span class="st"> </span><span class="kw">readOGR</span>(lakes_shapefile, <span class="dt">layer=</span>layer)</a>
<a class="sourceLine" id="cb10-22" title="22"><span class="kw">summary</span>(lakes_poly)  </a>
<a class="sourceLine" id="cb10-23" title="23"><span class="kw">plot</span>(lakes_poly, <span class="dt">bor=</span><span class="st">&quot;lightblue&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-24" title="24"></a>
<a class="sourceLine" id="cb10-25" title="25">lrglakes_poly &lt;-<span class="st"> </span>lakes_poly[<span class="kw">as.numeric</span>(lakes_poly<span class="op">$</span>scalerank) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span> ,]</a>
<a class="sourceLine" id="cb10-26" title="26"><span class="kw">plot</span>(lrglakes_poly, <span class="dt">bor=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="RMaps2_files/figure-html/read%20shapefiles,%20-1.png" width="75%" height="75%" /> Take a look at the <code>admin1_poly</code> dataframe, to figure out the codes for Candadian and U.S. provincial and state borders.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">head</span>(admin0_poly)</a></code></pre></div>
<pre><code>##   scalerank      featurecla LABELRANK     SOVEREIGNT SOV_A3 ADM0_DIF LEVEL              TYPE       ADMIN
## 0         3 Admin-0 country         5    Netherlands    NL1        1     2           Country       Aruba
## 1         0 Admin-0 country         3    Afghanistan    AFG        0     2 Sovereign country Afghanistan
## 2         0 Admin-0 country         3         Angola    AGO        0     2 Sovereign country      Angola
## 3         3 Admin-0 country         6 United Kingdom    GB1        1     2        Dependency    Anguilla
## 4         0 Admin-0 country         6        Albania    ALB        0     2 Sovereign country     Albania
## 5         3 Admin-0 country         6        Finland    FI1        1     2           Country       Aland
##   ADM0_A3 GEOU_DIF     GEOUNIT GU_A3 SU_DIF     SUBUNIT SU_A3 BRK_DIFF        NAME     NAME_LONG BRK_A3
## 0     ABW        0       Aruba   ABW      0       Aruba   ABW        0       Aruba         Aruba    ABW
## 1     AFG        0 Afghanistan   AFG      0 Afghanistan   AFG        0 Afghanistan   Afghanistan    AFG
## 2     AGO        0      Angola   AGO      0      Angola   AGO        0      Angola        Angola    AGO
## 3     AIA        0    Anguilla   AIA      0    Anguilla   AIA        0    Anguilla      Anguilla    AIA
## 4     ALB        0     Albania   ALB      0     Albania   ALB        0     Albania       Albania    ALB
## 5     ALD        0       Aland   ALD      0       Aland   ALD        0       Aland Aland Islands    ALD
##      BRK_NAME BRK_GROUP ABBREV POSTAL                    FORMAL_EN FORMAL_FR NOTE_ADM0 NOTE_BRK
## 0       Aruba      &lt;NA&gt;  Aruba     AW                        Aruba      &lt;NA&gt;     Neth.     &lt;NA&gt;
## 1 Afghanistan      &lt;NA&gt;   Afg.     AF Islamic State of Afghanistan      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;
## 2      Angola      &lt;NA&gt;   Ang.     AO  People&#39;s Republic of Angola      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;
## 3    Anguilla      &lt;NA&gt;   Ang.     AI                         &lt;NA&gt;      &lt;NA&gt;      U.K.     &lt;NA&gt;
## 4     Albania      &lt;NA&gt;   Alb.     AL          Republic of Albania      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;
## 5       Aland      &lt;NA&gt;  Aland     AI                Åland Islands      &lt;NA&gt;      Fin.     &lt;NA&gt;
##     NAME_SORT NAME_ALT MAPCOLOR7 MAPCOLOR8 MAPCOLOR9 MAPCOLOR13  POP_EST GDP_MD_EST POP_YEAR LASTCENSUS
## 0       Aruba     &lt;NA&gt;         4         2         2          9   103065     2258.0      -99       2010
## 1 Afghanistan     &lt;NA&gt;         5         6         8          7 28400000    22270.0      -99       1979
## 2      Angola     &lt;NA&gt;         3         2         6          1 12799293   110300.0      -99       1970
## 3    Anguilla     &lt;NA&gt;         6         6         6          3    14436      108.9      -99        -99
## 4     Albania     &lt;NA&gt;         1         4         1          6  3639453    21810.0      -99       2001
## 5       Aland     &lt;NA&gt;         4         1         4          6    27153     1563.0      -99        -99
##   GDP_YEAR                    ECONOMY              INCOME_GRP WIKIPEDIA FIPS_10_ ISO_A2 ISO_A3 ISO_N3
## 0      -99       6. Developing region 2. High income: nonOECD       -99       AA     AW    ABW    533
## 1      -99  7. Least developed region           5. Low income       -99       AF     AF    AFG    004
## 2      -99  7. Least developed region  3. Upper middle income       -99       AO     AO    AGO    024
## 3      -99       6. Developing region  3. Upper middle income       -99       AV     AI    AIA    660
## 4      -99       6. Developing region  4. Lower middle income       -99       AL     AL    ALB    008
## 5      -99 2. Developed region: nonG7    1. High income: OECD       -99      -99     AX    ALA    248
##   UN_A3 WB_A2 WB_A3   WOE_ID WOE_ID_EH                   WOE_NOTE ADM0_A3_IS ADM0_A3_US ADM0_A3_UN
## 0   533    AW   ABW 23424736  23424736 Exact WOE match as country        ABW        ABW        -99
## 1   004    AF   AFG 23424739  23424739 Exact WOE match as country        AFG        AFG        -99
## 2   024    AO   AGO 23424745  23424745 Exact WOE match as country        AGO        AGO        -99
## 3   660   -99   -99 23424751  23424751 Exact WOE match as country        AIA        AIA        -99
## 4   008    AL   ALB 23424742  23424742 Exact WOE match as country        ALB        ALB        -99
## 5   248   -99   -99 12577865  12577865 Exact WOE match as country        ALA        ALD        -99
##   ADM0_A3_WB     CONTINENT REGION_UN       SUBREGION                 REGION_WB NAME_LEN LONG_LEN
## 0        -99 North America  Americas       Caribbean Latin America &amp; Caribbean        5        5
## 1        -99          Asia      Asia   Southern Asia                South Asia       11       11
## 2        -99        Africa    Africa   Middle Africa        Sub-Saharan Africa        6        6
## 3        -99 North America  Americas       Caribbean Latin America &amp; Caribbean        8        8
## 4        -99        Europe    Europe Southern Europe     Europe &amp; Central Asia        7        7
## 5        -99        Europe    Europe Northern Europe     Europe &amp; Central Asia        5       13
##   ABBREV_LEN TINY HOMEPART
## 0          5    4      -99
## 1          4  -99        1
## 2          4  -99        1
## 3          4  -99      -99
## 4          4  -99        1
## 5          5    5      -99</code></pre>
<p>The approprate code to extract the U.S. and Canada data is <code>admin1_poly$sr_sov_a3 == "CAN"</code> and <code>admin1_poly$sr_sov_a3 == "US1"</code>. Extract the borders, and plot the resulting shapefiles.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">can_poly &lt;-<span class="st"> </span>admin1_poly[admin1_poly<span class="op">$</span>sov_a3 <span class="op">==</span><span class="st"> &quot;CAN&quot;</span> ,]</a>
<a class="sourceLine" id="cb13-2" title="2">us_poly &lt;-<span class="st"> </span>admin1_poly[admin1_poly<span class="op">$</span>sov_a3 <span class="op">==</span><span class="st"> &quot;US1&quot;</span>,]</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">plot</span>(coast_lines)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">plot</span>(can_poly, <span class="dt">bor=</span><span class="st">&quot;red&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="kw">plot</span>(us_poly, <span class="dt">bor=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="RMaps2_files/figure-html/extract%20US%20and%20Candada-1.png" width="75%" height="75%" /></p>
<p>Convert the U.S. and Canada polygons to <code>SpatialLines</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">can_lines &lt;-<span class="st"> </span><span class="kw">as</span>(can_poly, <span class="st">&quot;SpatialLines&quot;</span>)</a>
<a class="sourceLine" id="cb14-2" title="2">us_lines &lt;-<span class="st"> </span><span class="kw">as</span>(us_poly, <span class="st">&quot;SpatialLines&quot;</span>)</a></code></pre></div>
</div>
<div id="project-the-shape-files" class="section level2">
<h2><span class="header-section-number">1.2</span> Project the shape files</h2>
<p>Set the <code>proj4string</code> value and the coordinate reference system for the na10km_v2 grid:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">na_proj4string &lt;-<span class="st"> &quot;+proj=laea +lon_0=-100 +lat_0=50 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs&quot;</span></a>
<a class="sourceLine" id="cb15-2" title="2">na_crs =<span class="st"> </span><span class="kw">CRS</span>(na_proj4string)</a></code></pre></div>
<p>Project the various shapefiles (and plot the coastlines as an example):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">coast_lines_proj &lt;-<span class="kw">spTransform</span>(coast_lines, na_crs)</a>
<a class="sourceLine" id="cb16-2" title="2">admin0_poly_proj &lt;-<span class="kw">spTransform</span>(admin0_poly, na_crs)</a>
<a class="sourceLine" id="cb16-3" title="3">admin1_poly_proj &lt;-<span class="kw">spTransform</span>(admin1_poly, na_crs)</a>
<a class="sourceLine" id="cb16-4" title="4">lakes_poly_proj &lt;-<span class="kw">spTransform</span>(lakes_poly, na_crs)</a>
<a class="sourceLine" id="cb16-5" title="5">lrglakes_poly_proj &lt;-<span class="kw">spTransform</span>(lrglakes_poly, na_crs)</a>
<a class="sourceLine" id="cb16-6" title="6">can_poly_proj &lt;-<span class="kw">spTransform</span>(can_poly, na_crs)</a>
<a class="sourceLine" id="cb16-7" title="7">us_poly_proj &lt;-<span class="kw">spTransform</span>(us_poly, na_crs)</a>
<a class="sourceLine" id="cb16-8" title="8">can_lines_proj &lt;-<span class="kw">spTransform</span>(can_lines, na_crs)</a>
<a class="sourceLine" id="cb16-9" title="9">us_lines_proj &lt;-<span class="kw">spTransform</span>(us_lines, na_crs)</a>
<a class="sourceLine" id="cb16-10" title="10"></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="kw">plot</span>(coast_lines_proj)</a>
<a class="sourceLine" id="cb16-12" title="12"><span class="kw">plot</span>(admin0_poly_proj, <span class="dt">bor=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-13" title="13"><span class="kw">plot</span>(coast_lines_proj, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="RMaps2_files/figure-html/project%20shapefiles-1.png" width="75%" height="75%" /></p>
<p>Define a bounding box for trimming the polygon and line shape files to the area covered by the na10km_v2 grid. The extent of the area is known from the definition of the grid, but could also be determined by reading an na10km_v2 netCDF file. The projected <code>admin</code> shape files are quite complicated, and create “topology exception errors”. These can be fixed using an approach discussed on StackExchange <a href="http://gis.stackexchange.com/questions/163445/r-solution-for-topologyexception-input-geom-1-is-invalid-self-intersection-er">[link]</a></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">na10km_bb &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">extent</span>(<span class="op">-</span><span class="dv">5770000</span>,<span class="dv">5000000</span>,<span class="op">-</span><span class="dv">4510000</span>,<span class="dv">4480000</span>), <span class="st">&quot;SpatialPolygons&quot;</span>)</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">proj4string</span>(na10km_bb) &lt;-<span class="st"> </span>na_proj4string</a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4">na10km_coast_lines_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(coast_lines_proj, na10km_bb)</a>
<a class="sourceLine" id="cb17-5" title="5">na10km_lakes_poly_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(lakes_poly_proj, na10km_bb)</a>
<a class="sourceLine" id="cb17-6" title="6">na10km_lrglakes_poly_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(lrglakes_poly_proj, na10km_bb)</a>
<a class="sourceLine" id="cb17-7" title="7">na10km_can_poly_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(can_poly_proj, na10km_bb)</a>
<a class="sourceLine" id="cb17-8" title="8">na10km_us_poly_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(us_poly_proj, na10km_bb)</a>
<a class="sourceLine" id="cb17-9" title="9">na10km_can_lines_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(can_lines_proj, na10km_bb)</a>
<a class="sourceLine" id="cb17-10" title="10">na10km_us_lines_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(us_lines_proj, na10km_bb)</a></code></pre></div>
<p>Now do the <code>admin</code> shape files:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">na10km_bb &lt;-<span class="st"> </span><span class="kw">gBuffer</span>(na10km_bb, <span class="dt">byid=</span><span class="ot">TRUE</span>, <span class="dt">width=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb18-2" title="2">admin0_poly_proj &lt;-<span class="st"> </span><span class="kw">gSimplify</span>(admin0_poly_proj, <span class="dt">tol =</span> <span class="fl">0.00001</span>)</a>
<a class="sourceLine" id="cb18-3" title="3">na10km_admin0_poly_proj &lt;-<span class="st"> </span><span class="kw">gBuffer</span>(admin0_poly_proj, <span class="dt">byid=</span><span class="ot">TRUE</span>, <span class="dt">width=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb18-4" title="4">na10km_admin0_poly_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(admin0_poly_proj, <span class="dt">byid=</span><span class="ot">TRUE</span>, na10km_bb)</a>
<a class="sourceLine" id="cb18-5" title="5">admin1_poly_proj &lt;-<span class="st"> </span><span class="kw">gSimplify</span>(admin1_poly_proj, <span class="dt">tol =</span> <span class="fl">0.00001</span>)</a>
<a class="sourceLine" id="cb18-6" title="6">na10km_admin1_poly_proj &lt;-<span class="st"> </span><span class="kw">gBuffer</span>(admin1_poly_proj, <span class="dt">byid=</span><span class="ot">TRUE</span>, <span class="dt">width=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb18-7" title="7">na10km_admin1_poly_proj &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(admin1_poly_proj, <span class="dt">byid=</span><span class="ot">TRUE</span>, na10km_bb)</a></code></pre></div>
<p>Plot the projected shapefiles.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">plot</span>(na10km_coast_lines_proj)</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">plot</span>(na10km_admin0_poly_proj, <span class="dt">bor=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">plot</span>(na10km_can_lines_proj, <span class="dt">col=</span><span class="st">&quot;pink&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-4" title="4"><span class="kw">plot</span>(na10km_us_lines_proj, <span class="dt">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-5" title="5"><span class="kw">plot</span>(na10km_lrglakes_poly_proj, <span class="dt">bor=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-6" title="6"><span class="kw">plot</span>(na10km_bb, <span class="dt">bor=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="RMaps2_files/figure-html/plot%20projected%20shapefiles-1.png" width="75%" height="75%" /></p>
</div>
<div id="write-out-the-projected-and-trimmed-shape-files" class="section level2">
<h2><span class="header-section-number">1.3</span> Write out the projected and trimmed shape files</h2>
<p>Next, write out the projected shapefiles, first setting the output path.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># write out the various shapefiles </span></a>
<a class="sourceLine" id="cb20-2" title="2">outpath &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/RMaps/derived/na10km_10m/&quot;</span></a>
<a class="sourceLine" id="cb20-3" title="3">outshape &lt;-<span class="st"> </span>na10km_coast_lines_proj</a>
<a class="sourceLine" id="cb20-4" title="4">outfile &lt;-<span class="st"> &quot;na10km_10m_coast_lines&quot;</span></a>
<a class="sourceLine" id="cb20-5" title="5">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb20-6" title="6">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb20-7" title="7"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb20-8" title="8">outshape &lt;-<span class="st"> </span><span class="kw">SpatialLinesDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb20-9" title="9"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>It’s always good practice to test whether the shapefile has ideed been written out correctly. Read it back in and plot it.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">test &lt;-<span class="st"> </span><span class="kw">readOGR</span>(outshapefile)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/bartlein/Projects/ESSD/data/RMaps/derived/na10km_10m/na10km_10m_coast_lines&quot;, layer: &quot;na10km_10m_coast_lines&quot;
## with 1 features
## It has 1 fields</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">plot</span>(test, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</a></code></pre></div>
<p><img src="RMaps2_files/figure-html/test%20shape2-1.png" width="75%" height="75%" /></p>
<p>Write out the other shape files (output is suppressed):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="co"># write out the various shapefiles </span></a>
<a class="sourceLine" id="cb24-2" title="2">outshape &lt;-<span class="st"> </span>na10km_bb</a>
<a class="sourceLine" id="cb24-3" title="3">outfile &lt;-<span class="st"> &quot;na10km_10m_bb&quot;</span></a>
<a class="sourceLine" id="cb24-4" title="4">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-5" title="5">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-6" title="6"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-7" title="7">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-8" title="8"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-9" title="9"></a>
<a class="sourceLine" id="cb24-10" title="10">outshape &lt;-<span class="st"> </span>na10km_lakes_poly_proj</a>
<a class="sourceLine" id="cb24-11" title="11">outfile &lt;-<span class="st"> &quot;na10km_10m_lakes_poly&quot;</span></a>
<a class="sourceLine" id="cb24-12" title="12">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-13" title="13">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-14" title="14"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-15" title="15">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-16" title="16"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-17" title="17"></a>
<a class="sourceLine" id="cb24-18" title="18">outshape &lt;-<span class="st"> </span>na10km_lrglakes_poly_proj</a>
<a class="sourceLine" id="cb24-19" title="19">outfile &lt;-<span class="st"> &quot;na10km_10m_lrglakes_poly&quot;</span></a>
<a class="sourceLine" id="cb24-20" title="20">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-21" title="21">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-22" title="22"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-23" title="23">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-24" title="24"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-25" title="25"></a>
<a class="sourceLine" id="cb24-26" title="26">outshape &lt;-<span class="st"> </span>na10km_can_poly_proj</a>
<a class="sourceLine" id="cb24-27" title="27">outfile &lt;-<span class="st"> &quot;na10km_10m_can_poly&quot;</span></a>
<a class="sourceLine" id="cb24-28" title="28">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-29" title="29">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-30" title="30"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-31" title="31">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-32" title="32"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-33" title="33"></a>
<a class="sourceLine" id="cb24-34" title="34">outshape &lt;-<span class="st"> </span>na10km_us_poly_proj</a>
<a class="sourceLine" id="cb24-35" title="35">outfile &lt;-<span class="st"> &quot;na10km_10m_us_poly&quot;</span></a>
<a class="sourceLine" id="cb24-36" title="36">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-37" title="37">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-38" title="38"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-39" title="39">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-40" title="40"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-41" title="41"></a>
<a class="sourceLine" id="cb24-42" title="42">outshape &lt;-<span class="st"> </span>na10km_can_lines_proj</a>
<a class="sourceLine" id="cb24-43" title="43">outfile &lt;-<span class="st"> &quot;na10km_10m_can_lines&quot;</span></a>
<a class="sourceLine" id="cb24-44" title="44">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-45" title="45">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-46" title="46"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-47" title="47">outshape &lt;-<span class="st"> </span><span class="kw">SpatialLinesDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-48" title="48"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-49" title="49"></a>
<a class="sourceLine" id="cb24-50" title="50">outshape &lt;-<span class="st"> </span>na10km_us_lines_proj</a>
<a class="sourceLine" id="cb24-51" title="51">outfile &lt;-<span class="st"> &quot;na10km_10m_us_lines&quot;</span></a>
<a class="sourceLine" id="cb24-52" title="52">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-53" title="53">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-54" title="54"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-55" title="55">outshape &lt;-<span class="st"> </span><span class="kw">SpatialLinesDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-56" title="56"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-57" title="57"></a>
<a class="sourceLine" id="cb24-58" title="58">outshape &lt;-<span class="st"> </span>na10km_admin0_poly_proj</a>
<a class="sourceLine" id="cb24-59" title="59">outfile &lt;-<span class="st"> &quot;na10km_10m_admin0_poly&quot;</span></a>
<a class="sourceLine" id="cb24-60" title="60">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-61" title="61">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-62" title="62"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-63" title="63">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-64" title="64"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-65" title="65"></a>
<a class="sourceLine" id="cb24-66" title="66">outshape &lt;-<span class="st"> </span>na10km_admin1_poly_proj</a>
<a class="sourceLine" id="cb24-67" title="67">outfile &lt;-<span class="st"> &quot;na10km_10m_admin1_poly&quot;</span></a>
<a class="sourceLine" id="cb24-68" title="68">outshapefile &lt;-<span class="st"> </span><span class="kw">paste</span>(outpath,outfile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-69" title="69">spdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">row.names</span>(outshape)))</a>
<a class="sourceLine" id="cb24-70" title="70"><span class="kw">row.names</span>(spdf) &lt;-<span class="st"> </span><span class="kw">row.names</span>(outshape)</a>
<a class="sourceLine" id="cb24-71" title="71">outshape &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(outshape, spdf)</a>
<a class="sourceLine" id="cb24-72" title="72"><span class="kw">writeOGR</span>(outshape, outshapefile, outfile, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><a href="Rmaps2.html">[Back to top]</a></p>
</div>
</div>
<div id="map-of-north-american-shaded-relief" class="section level1">
<h1><span class="header-section-number">2</span> Map of North American shaded relief</h1>
<div id="read-the-read-the-projected-and-trimmed-shapefiles" class="section level2">
<h2><span class="header-section-number">2.1</span> Read the read the projected and trimmed shapefiles</h2>
<p>Load the appropriate packages.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">library</span>(sp)</a></code></pre></div>
<p>Read the shapefiles:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">shapepath &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/RMaps/derived/na10km_10m/&quot;</span></a>
<a class="sourceLine" id="cb26-2" title="2">na10km_bb &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_bb.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb26-3" title="3">na10km_coast_lines_proj &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_coast_lines.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb26-4" title="4">na10km_admin0_poly_proj &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_admin0_poly.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb26-5" title="5">na10km_lakes_poly_proj &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_lakes_poly.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb26-6" title="6">na10km_lrglakes_poly_proj &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_lrglakes_poly.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb26-7" title="7">na10km_can_lines_proj &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_can_lines.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb26-8" title="8">na10km_us_lines_proj &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste</span>(shapepath, <span class="st">&quot;na10km_10m_us_lines.shp&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a></code></pre></div>
<p>Plot the projected and trimmed shapefiles:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">plot</span>(na10km_admin0_poly_proj, <span class="dt">bor=</span><span class="st">&quot;gray&quot;</span>)</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">plot</span>(na10km_can_lines_proj, <span class="dt">col=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb27-3" title="3"><span class="kw">plot</span>(na10km_us_lines_proj, <span class="dt">col=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb27-4" title="4"><span class="kw">plot</span>(na10km_lrglakes_poly_proj, <span class="dt">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb27-5" title="5"><span class="kw">plot</span>(na10km_coast_lines_proj, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb27-6" title="6"><span class="kw">plot</span>(na10km_bb, <span class="dt">bor=</span><span class="st">&quot;black&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="RMaps2_files/figure-html/plot%20projected%20and%20trimmed%20shapefiles-1.png" width="75%" height="75%" /></p>
</div>
<div id="read-a-shaded-relief-file" class="section level2">
<h2><span class="header-section-number">2.2</span> Read a shaded relief file</h2>
<p>Read a pre-computed shaded relief file. This could also be crearted by reading the na10km_v2 grid-point elevations and using the <code>hillshade</code> function from the <code>raster</code> package. Note that in this file, the coordinates are in km, and so they must be multiplied by 1000.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">datapath &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/csv_files/&quot;</span></a>
<a class="sourceLine" id="cb28-2" title="2">datafile &lt;-<span class="st"> &quot;na10km_shade.csv&quot;</span></a>
<a class="sourceLine" id="cb28-3" title="3">shade &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste</span>(datapath,datafile,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb28-4" title="4">shade<span class="op">$</span>x &lt;-<span class="st"> </span>shade<span class="op">$</span>x<span class="op">*</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb28-5" title="5">shade<span class="op">$</span>y &lt;-<span class="st"> </span>shade<span class="op">$</span>y<span class="op">*</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="kw">head</span>(shade)</a></code></pre></div>
<pre><code>##          x       y    shade      lat       lon
## 1 -5770000 -820000 0.691208 21.83661 -160.1851
## 2 -5760000 -820000 0.691208 21.90175 -160.1023
## 3 -5720000 -860000 0.310095 21.90119 -159.5651
## 4 -5720000 -850000 0.333957 21.96637 -159.6163
## 5 -5720000 -840000 0.559432 22.03148 -159.6676
## 6 -5720000 -830000 0.956591 22.09651 -159.7191</code></pre>
<p>Convert the dataframe to a SpatialPixelsData Frame</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">coordinates</span>(shade) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb30-2" title="2"><span class="kw">points2grid</span>(shade)</a></code></pre></div>
<pre><code>## Warning in points2grid(shade): grid has empty column/rows in dimension 1</code></pre>
<pre><code>##                          x        y
## cellcentre.offset -5770000 -4510000
## cellsize             10000    10000
## cells.dim             1078      900</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">shade_pixels &lt;-<span class="st"> </span><span class="kw">as</span>(shade, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in points2grid(points, tolerance, round): grid has empty column/rows in dimension 1</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">summary</span>(shade_pixels)</a></code></pre></div>
<pre><code>## Object of class SpatialPixelsDataFrame
## Coordinates:
##        min     max
## x -5775000 5005000
## y -4515000 4485000
## Is projected: NA 
## proj4string : [NA]
## Number of points: 282017
## Grid attributes:
##   cellcentre.offset cellsize cells.dim
## x          -5770000    10000      1078
## y          -4510000    10000       900
## Data attributes:
##      shade              lat              lon          
##  Min.   :-0.5064   Min.   :-2.757   Min.   :-203.188  
##  1st Qu.: 0.6297   1st Qu.:35.292   1st Qu.:-113.434  
##  Median : 0.6958   Median :49.353   Median : -96.309  
##  Mean   : 0.6556   Mean   :46.929   Mean   : -96.031  
##  3rd Qu.: 0.7318   3rd Qu.:62.580   3rd Qu.: -74.614  
##  Max.   : 1.0000   Max.   :83.617   Max.   :   4.453</code></pre>
<p>Read some predetermined (gray-scale) colors for the shading.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">colorfile &lt;-<span class="st"> &quot;shade40_clr.csv&quot;</span></a>
<a class="sourceLine" id="cb37-2" title="2">shade_rgb &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste</span>(datapath, colorfile, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb37-3" title="3">shade_clr &lt;-<span class="st"> </span><span class="kw">rgb</span>(shade_rgb)</a></code></pre></div>
<p>Set the (gray-scale) color numbers for each pixel:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">shade_int &lt;-<span class="st"> </span><span class="kw">as.integer</span>(((shade<span class="op">$</span>shade<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">40</span>)<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb38-2" title="2">shade_colnum &lt;-<span class="st"> </span>shade_clr[shade_int]</a></code></pre></div>
</div>
<div id="make-the-map" class="section level2">
<h2><span class="header-section-number">2.3</span> Make the map</h2>
<p>Plot the shaded-relief colors and the various shape files. The location of the text string was determined by plotting an initial version ofthe map, and using the <code>locate()</code> function. The <code>cex=0.09</code> argument in the <code>points()</code> function was detrmined by trial and error.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">pdf</span>(<span class="dt">file =</span> <span class="st">&quot;na_shade01b.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb39-2" title="2"><span class="kw">plot</span>(na10km_bb, <span class="dt">col=</span><span class="st">&quot;gray95&quot;</span>)</a>
<a class="sourceLine" id="cb39-3" title="3"><span class="kw">points</span>(shade_pixels, <span class="dt">pch=</span><span class="dv">15</span>, <span class="dt">cex=</span><span class="fl">0.09</span>, <span class="dt">col=</span>shade_colnum)</a>
<a class="sourceLine" id="cb39-4" title="4"><span class="kw">plot</span>(na10km_admin0_poly_proj, <span class="dt">lwd=</span><span class="fl">0.2</span>, <span class="dt">bor=</span><span class="st">&quot;gray50&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-5" title="5"><span class="kw">plot</span>(na10km_can_lines_proj, <span class="dt">lwd=</span><span class="fl">0.2</span>, <span class="dt">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-6" title="6"><span class="kw">plot</span>(na10km_us_lines_proj, <span class="dt">lwd=</span><span class="fl">0.2</span>, <span class="dt">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-7" title="7"><span class="kw">plot</span>(na10km_lrglakes_poly_proj, <span class="dt">lwd=</span><span class="fl">0.2</span>, <span class="dt">bor=</span><span class="st">&quot;black&quot;</span>, <span class="dt">col=</span><span class="st">&quot;gray90&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-8" title="8"><span class="kw">plot</span>(na10km_coast_lines_proj, <span class="dt">lwd=</span><span class="fl">0.3</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-9" title="9"><span class="kw">text</span>(<span class="op">-</span><span class="dv">5770000</span>, <span class="dv">4620000</span>, <span class="dt">pos=</span><span class="kw">c</span>(<span class="dv">4</span>), <span class="dt">offset=</span><span class="fl">0.0</span>, <span class="dt">cex=</span><span class="fl">1.0</span>, <span class="st">&quot;NA10km_v2 -- 10m Natural Earth Outlines&quot;</span>)</a>
<a class="sourceLine" id="cb39-10" title="10"><span class="kw">plot</span>(na10km_bb, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-11" title="11"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>The resulting plot will look like this: <img src="images/na_shade01b.png" /></p>
<p><a href="Rmaps2.html">[Back to top]</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
